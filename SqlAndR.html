<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 SQL and R | The Book of OHDSI</title>
  <meta name="description" content="A book about the Observational Health Data Sciences and Informatics (OHDSI). It described the OHDSI community, open standards and open source software." />
  <meta name="generator" content="bookdown 0.21.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 SQL and R | The Book of OHDSI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ohdsi.github.io/TheBookOfOhdsi/" />
  <meta property="og:image" content="https://ohdsi.github.io/TheBookOfOhdsi//images/Cover/Cover.png" />
  <meta property="og:description" content="A book about the Observational Health Data Sciences and Informatics (OHDSI). It described the OHDSI community, open standards and open source software." />
  <meta name="github-repo" content="OHDSI/TheBookOfOhdsi" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 SQL and R | The Book of OHDSI" />
  
  <meta name="twitter:description" content="A book about the Observational Health Data Sciences and Informatics (OHDSI). It described the OHDSI community, open standards and open source software." />
  <meta name="twitter:image" content="https://ohdsi.github.io/TheBookOfOhdsi//images/Cover/Cover.png" />

<meta name="author" content="Observational Health Data Sciences and Informatics" />


<meta name="date" content="2021-01-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="OhdsiAnalyticsTools.html"/>
<link rel="next" href="Cohorts.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104086677-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104086677-2');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Book of OHDSI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#goals-of-this-book"><i class="fa fa-check"></i>Goals of this Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software-versions"><i class="fa fa-check"></i>Software Versions</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-the-book-is-developed"><i class="fa fa-check"></i>How the Book Is Developed</a></li>
</ul></li>
<li class="part"><span><b>I The OHDSI Community</b></span></li>
<li class="chapter" data-level="1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html"><i class="fa fa-check"></i><b>1</b> The OHDSI Community</a><ul>
<li class="chapter" data-level="1.1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#the-journey-from-data-to-evidence"><i class="fa fa-check"></i><b>1.1</b> The Journey from Data to Evidence</a></li>
<li class="chapter" data-level="1.2" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#observational-medical-outcomes-partnership"><i class="fa fa-check"></i><b>1.2</b> Observational Medical Outcomes Partnership</a></li>
<li class="chapter" data-level="1.3" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#ohdsi-as-an-open-science-collaborative"><i class="fa fa-check"></i><b>1.3</b> OHDSI as an Open-Science Collaborative</a><ul>
<li class="chapter" data-level="1.3.1" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#our-mission"><i class="fa fa-check"></i><b>1.3.1</b> Our Mission</a></li>
<li class="chapter" data-level="1.3.2" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#our-vision"><i class="fa fa-check"></i><b>1.3.2</b> Our Vision</a></li>
<li class="chapter" data-level="1.3.3" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#our-objectives"><i class="fa fa-check"></i><b>1.3.3</b> Our Objectives</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#ohdsis-progress"><i class="fa fa-check"></i><b>1.4</b> OHDSI’s Progress</a></li>
<li class="chapter" data-level="1.5" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#collaborating-in-ohdsi"><i class="fa fa-check"></i><b>1.5</b> Collaborating in OHDSI</a></li>
<li class="chapter" data-level="1.6" data-path="OhdsiCommunity.html"><a href="OhdsiCommunity.html#summary"><i class="fa fa-check"></i><b>1.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="WhereToBegin.html"><a href="WhereToBegin.html"><i class="fa fa-check"></i><b>2</b> Where to Begin</a><ul>
<li class="chapter" data-level="2.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#join-the-journey"><i class="fa fa-check"></i><b>2.1</b> Join the Journey</a><ul>
<li class="chapter" data-level="2.1.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-forums"><i class="fa fa-check"></i><b>2.1.1</b> OHDSI Forums</a></li>
<li class="chapter" data-level="2.1.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-events"><i class="fa fa-check"></i><b>2.1.2</b> OHDSI Events</a></li>
<li class="chapter" data-level="2.1.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-community-calls"><i class="fa fa-check"></i><b>2.1.3</b> OHDSI Community Calls</a></li>
<li class="chapter" data-level="2.1.4" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-workgroups"><i class="fa fa-check"></i><b>2.1.4</b> OHDSI Workgroups</a></li>
<li class="chapter" data-level="2.1.5" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-regional-chapters"><i class="fa fa-check"></i><b>2.1.5</b> OHDSI Regional Chapters</a></li>
<li class="chapter" data-level="2.1.6" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-research-network"><i class="fa fa-check"></i><b>2.1.6</b> OHDSI Research Network</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#where-you-fit-in"><i class="fa fa-check"></i><b>2.2</b> Where You Fit In</a></li>
<li class="chapter" data-level="2.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#summary-1"><i class="fa fa-check"></i><b>2.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="OpenScience.html"><a href="OpenScience.html"><i class="fa fa-check"></i><b>3</b> Open Science</a><ul>
<li class="chapter" data-level="3.1" data-path="OpenScience.html"><a href="OpenScience.html#open-science"><i class="fa fa-check"></i><b>3.1</b> Open Science</a></li>
<li class="chapter" data-level="3.2" data-path="OpenScience.html"><a href="OpenScience.html#open-science-in-action-the-study-a-thon"><i class="fa fa-check"></i><b>3.2</b> Open-Science in Action: the Study-a-Thon</a></li>
<li class="chapter" data-level="3.3" data-path="OpenScience.html"><a href="OpenScience.html#open-standards"><i class="fa fa-check"></i><b>3.3</b> Open Standards</a></li>
<li class="chapter" data-level="3.4" data-path="OpenScience.html"><a href="OpenScience.html#open-source"><i class="fa fa-check"></i><b>3.4</b> Open Source</a></li>
<li class="chapter" data-level="3.5" data-path="OpenScience.html"><a href="OpenScience.html#open-data"><i class="fa fa-check"></i><b>3.5</b> Open Data</a></li>
<li class="chapter" data-level="3.6" data-path="OpenScience.html"><a href="OpenScience.html#open-discourse"><i class="fa fa-check"></i><b>3.6</b> Open Discourse</a></li>
<li class="chapter" data-level="3.7" data-path="OpenScience.html"><a href="OpenScience.html#ohdsi-and-the-fair-guiding-principles"><i class="fa fa-check"></i><b>3.7</b> OHDSI and the FAIR Guiding Principles</a><ul>
<li class="chapter" data-level="3.7.1" data-path="OpenScience.html"><a href="OpenScience.html#introduction"><i class="fa fa-check"></i><b>3.7.1</b> Introduction</a></li>
<li class="chapter" data-level="3.7.2" data-path="OpenScience.html"><a href="OpenScience.html#findability"><i class="fa fa-check"></i><b>3.7.2</b> Findability</a></li>
<li class="chapter" data-level="3.7.3" data-path="OpenScience.html"><a href="OpenScience.html#accessibility"><i class="fa fa-check"></i><b>3.7.3</b> Accessibility</a></li>
<li class="chapter" data-level="3.7.4" data-path="OpenScience.html"><a href="OpenScience.html#interoperability"><i class="fa fa-check"></i><b>3.7.4</b> Interoperability</a></li>
<li class="chapter" data-level="3.7.5" data-path="OpenScience.html"><a href="OpenScience.html#reusability"><i class="fa fa-check"></i><b>3.7.5</b> Reusability</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Uniform Data Representation</b></span></li>
<li class="chapter" data-level="4" data-path="CommonDataModel.html"><a href="CommonDataModel.html"><i class="fa fa-check"></i><b>4</b> The Common Data Model</a><ul>
<li class="chapter" data-level="4.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#design-principles"><i class="fa fa-check"></i><b>4.1</b> Design Principles</a></li>
<li class="chapter" data-level="4.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#data-model-conventions"><i class="fa fa-check"></i><b>4.2</b> Data Model Conventions</a><ul>
<li class="chapter" data-level="4.2.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#model-Conv"><i class="fa fa-check"></i><b>4.2.1</b> General Conventions of the Model</a></li>
<li class="chapter" data-level="4.2.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-schemas"><i class="fa fa-check"></i><b>4.2.2</b> General Conventions of Schemas</a></li>
<li class="chapter" data-level="4.2.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-data-tables"><i class="fa fa-check"></i><b>4.2.3</b> General Conventions of Data Tables</a></li>
<li class="chapter" data-level="4.2.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#domains"><i class="fa fa-check"></i><b>4.2.4</b> General Conventions of Domains</a></li>
<li class="chapter" data-level="4.2.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#representation-of-content-through-concepts"><i class="fa fa-check"></i><b>4.2.5</b> Representation of Content Through Concepts</a></li>
<li class="chapter" data-level="4.2.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-naming-conventions-of-fields"><i class="fa fa-check"></i><b>4.2.6</b> General Naming Conventions of Fields</a></li>
<li class="chapter" data-level="4.2.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#concepts-Sources"><i class="fa fa-check"></i><b>4.2.7</b> Difference Between Concepts and Source Values</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#cdm-standardized-tables"><i class="fa fa-check"></i><b>4.3</b> CDM Standardized Tables</a><ul>
<li class="chapter" data-level="4.3.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#running-example-endometriosis"><i class="fa fa-check"></i><b>4.3.1</b> Running Example: Endometriosis</a></li>
<li class="chapter" data-level="4.3.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#person"><i class="fa fa-check"></i><b>4.3.2</b> PERSON Table</a></li>
<li class="chapter" data-level="4.3.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#observationPeriod"><i class="fa fa-check"></i><b>4.3.3</b> OBSERVATION_PERIOD Table</a></li>
<li class="chapter" data-level="4.3.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#visitOccurrence"><i class="fa fa-check"></i><b>4.3.4</b> VISIT_OCCURRENCE</a></li>
<li class="chapter" data-level="4.3.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#conditionOccurrence"><i class="fa fa-check"></i><b>4.3.5</b> CONDITION_OCCURRENCE</a></li>
<li class="chapter" data-level="4.3.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#drugExposure"><i class="fa fa-check"></i><b>4.3.6</b> DRUG_EXPOSURE</a></li>
<li class="chapter" data-level="4.3.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#procedureOccurrence"><i class="fa fa-check"></i><b>4.3.7</b> PROCEDURE_OCCURRENCE</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#additional-information"><i class="fa fa-check"></i><b>4.4</b> Additional Information</a></li>
<li class="chapter" data-level="4.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#summary-2"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
<li class="chapter" data-level="4.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#exercises"><i class="fa fa-check"></i><b>4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html"><i class="fa fa-check"></i><b>5</b> Standardized Vocabularies</a><ul>
<li class="chapter" data-level="5.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#why-vocabularies-and-why-standardizing"><i class="fa fa-check"></i><b>5.1</b> Why Vocabularies, and Why Standardizing</a><ul>
<li class="chapter" data-level="5.1.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#building-the-standardized-vocabularies"><i class="fa fa-check"></i><b>5.1.1</b> Building the Standardized Vocabularies</a></li>
<li class="chapter" data-level="5.1.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#accessVocabularies"><i class="fa fa-check"></i><b>5.1.2</b> Access to the Standardized Vocabularies</a></li>
<li class="chapter" data-level="5.1.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#source-of-vocabularies-adopt-versus-build"><i class="fa fa-check"></i><b>5.1.3</b> Source of Vocabularies: Adopt Versus Build</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#concepts"><i class="fa fa-check"></i><b>5.2</b> Concepts</a><ul>
<li class="chapter" data-level="5.2.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#concept-ids"><i class="fa fa-check"></i><b>5.2.1</b> Concept IDs</a></li>
<li class="chapter" data-level="5.2.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#concept-names"><i class="fa fa-check"></i><b>5.2.2</b> Concept Names</a></li>
<li class="chapter" data-level="5.2.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptDomains"><i class="fa fa-check"></i><b>5.2.3</b> Domains</a></li>
<li class="chapter" data-level="5.2.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#vocabularies"><i class="fa fa-check"></i><b>5.2.4</b> Vocabularies</a></li>
<li class="chapter" data-level="5.2.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#concept-classes"><i class="fa fa-check"></i><b>5.2.5</b> Concept Classes</a></li>
<li class="chapter" data-level="5.2.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#standardConcepts"><i class="fa fa-check"></i><b>5.2.6</b> Standard Concepts</a></li>
<li class="chapter" data-level="5.2.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#non-standard-concepts"><i class="fa fa-check"></i><b>5.2.7</b> Non-Standard Concepts</a></li>
<li class="chapter" data-level="5.2.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#classification-concepts"><i class="fa fa-check"></i><b>5.2.8</b> Classification Concepts</a></li>
<li class="chapter" data-level="5.2.9" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#concept-codes"><i class="fa fa-check"></i><b>5.2.9</b> Concept Codes</a></li>
<li class="chapter" data-level="5.2.10" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptLifeCycle"><i class="fa fa-check"></i><b>5.2.10</b> Life-Cycle</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#relationships"><i class="fa fa-check"></i><b>5.3</b> Relationships</a><ul>
<li class="chapter" data-level="5.3.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptMapping"><i class="fa fa-check"></i><b>5.3.1</b> Mapping Relationships</a></li>
<li class="chapter" data-level="5.3.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#hierarchical-relationships"><i class="fa fa-check"></i><b>5.3.2</b> Hierarchical Relationships</a></li>
<li class="chapter" data-level="5.3.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#relationships-between-concepts-of-different-vocabularies"><i class="fa fa-check"></i><b>5.3.3</b> Relationships Between Concepts of Different Vocabularies</a></li>
<li class="chapter" data-level="5.3.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#relationships-between-concepts-of-the-same-vocabulary"><i class="fa fa-check"></i><b>5.3.4</b> Relationships Between Concepts of the Same Vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#conceptAncestor"><i class="fa fa-check"></i><b>5.4</b> Hierarchy</a></li>
<li class="chapter" data-level="5.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#internal-reference-tables"><i class="fa fa-check"></i><b>5.5</b> Internal Reference Tables</a></li>
<li class="chapter" data-level="5.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#specialSituations"><i class="fa fa-check"></i><b>5.6</b> Special Situations</a><ul>
<li class="chapter" data-level="5.6.1" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#gender"><i class="fa fa-check"></i><b>5.6.1</b> Gender</a></li>
<li class="chapter" data-level="5.6.2" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#race-and-ethnicity"><i class="fa fa-check"></i><b>5.6.2</b> Race and Ethnicity</a></li>
<li class="chapter" data-level="5.6.3" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#diagnostic-coding-schemes-and-omop-conditions"><i class="fa fa-check"></i><b>5.6.3</b> Diagnostic Coding Schemes and OMOP Conditions</a></li>
<li class="chapter" data-level="5.6.4" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#procedure-coding-systems"><i class="fa fa-check"></i><b>5.6.4</b> Procedure Coding Systems</a></li>
<li class="chapter" data-level="5.6.5" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#devices"><i class="fa fa-check"></i><b>5.6.5</b> Devices</a></li>
<li class="chapter" data-level="5.6.6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#visits-and-services"><i class="fa fa-check"></i><b>5.6.6</b> Visits and Services</a></li>
<li class="chapter" data-level="5.6.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#providers-and-specialties"><i class="fa fa-check"></i><b>5.6.7</b> Providers and Specialties</a></li>
<li class="chapter" data-level="5.6.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#therapeutic-areas-with-special-requirements"><i class="fa fa-check"></i><b>5.6.8</b> Therapeutic Areas With Special Requirements</a></li>
<li class="chapter" data-level="5.6.9" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#rxNormExtension"><i class="fa fa-check"></i><b>5.6.9</b> Standard Concepts in the Drug Domain</a></li>
<li class="chapter" data-level="5.6.10" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#flavors-of-null"><i class="fa fa-check"></i><b>5.6.10</b> Flavors of NULL</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#summary-3"><i class="fa fa-check"></i><b>5.7</b> Summary</a></li>
<li class="chapter" data-level="5.8" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html#exercises-1"><i class="fa fa-check"></i><b>5.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html"><i class="fa fa-check"></i><b>6</b> Extract Transform Load</a><ul>
<li class="chapter" data-level="6.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#introduction-1"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#step-1-design-the-etl"><i class="fa fa-check"></i><b>6.2</b> Step 1: Design the ETL</a><ul>
<li class="chapter" data-level="6.2.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#white-rabbit"><i class="fa fa-check"></i><b>6.2.1</b> White Rabbit</a></li>
<li class="chapter" data-level="6.2.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#rabbit-in-a-hat"><i class="fa fa-check"></i><b>6.2.2</b> Rabbit-In-a-Hat</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#step-2-create-the-code-mappings"><i class="fa fa-check"></i><b>6.3</b> Step 2: Create the Code Mappings</a><ul>
<li class="chapter" data-level="6.3.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#usagi"><i class="fa fa-check"></i><b>6.3.1</b> Usagi</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#step-3-implement-the-etl"><i class="fa fa-check"></i><b>6.4</b> Step 3: Implement the ETL</a></li>
<li class="chapter" data-level="6.5" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#step-4-quality-control"><i class="fa fa-check"></i><b>6.5</b> Step 4: Quality Control</a></li>
<li class="chapter" data-level="6.6" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etl-conventions-and-themis"><i class="fa fa-check"></i><b>6.6</b> ETL Conventions and THEMIS</a></li>
<li class="chapter" data-level="6.7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#CDMandETLMaintenance"><i class="fa fa-check"></i><b>6.7</b> CDM and ETL Maintenance</a></li>
<li class="chapter" data-level="6.8" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#final-thoughts-on-etl"><i class="fa fa-check"></i><b>6.8</b> Final Thoughts on ETL</a></li>
<li class="chapter" data-level="6.9" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#summary-4"><i class="fa fa-check"></i><b>6.9</b> Summary</a></li>
<li class="chapter" data-level="6.10" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#exercises-2"><i class="fa fa-check"></i><b>6.10</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Data Analytics</b></span></li>
<li class="chapter" data-level="7" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html"><i class="fa fa-check"></i><b>7</b> Data Analytics Use Cases</a><ul>
<li class="chapter" data-level="7.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#characterization"><i class="fa fa-check"></i><b>7.1</b> Characterization</a></li>
<li class="chapter" data-level="7.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#population-level-estimation"><i class="fa fa-check"></i><b>7.2</b> Population-Level Estimation</a></li>
<li class="chapter" data-level="7.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#patient-level-prediction"><i class="fa fa-check"></i><b>7.3</b> Patient-Level Prediction</a></li>
<li class="chapter" data-level="7.4" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#example-use-cases-in-hypertension"><i class="fa fa-check"></i><b>7.4</b> Example Use Cases in Hypertension</a><ul>
<li class="chapter" data-level="7.4.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#characterization-questions"><i class="fa fa-check"></i><b>7.4.1</b> Characterization Questions</a></li>
<li class="chapter" data-level="7.4.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#population-level-estimation-question"><i class="fa fa-check"></i><b>7.4.2</b> Population-Level Estimation Question</a></li>
<li class="chapter" data-level="7.4.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#patient-level-prediction-question"><i class="fa fa-check"></i><b>7.4.3</b> Patient-Level Prediction Question</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#limitations-of-observational-research"><i class="fa fa-check"></i><b>7.5</b> Limitations of Observational Research</a><ul>
<li class="chapter" data-level="7.5.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#erroneous-data"><i class="fa fa-check"></i><b>7.5.1</b> Erroneous Data</a></li>
<li class="chapter" data-level="7.5.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#missing-data"><i class="fa fa-check"></i><b>7.5.2</b> Missing Data</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#summary-5"><i class="fa fa-check"></i><b>7.6</b> Summary</a></li>
<li class="chapter" data-level="7.7" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#exercises-3"><i class="fa fa-check"></i><b>7.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html"><i class="fa fa-check"></i><b>8</b> OHDSI Analytics Tools</a><ul>
<li class="chapter" data-level="8.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysisImplementation"><i class="fa fa-check"></i><b>8.1</b> Analysis Implementation</a></li>
<li class="chapter" data-level="8.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysis-strategies"><i class="fa fa-check"></i><b>8.2</b> Analysis Strategies</a></li>
<li class="chapter" data-level="8.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#atlas"><i class="fa fa-check"></i><b>8.3</b> ATLAS</a><ul>
<li class="chapter" data-level="8.3.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#security"><i class="fa fa-check"></i><b>8.3.1</b> Security</a></li>
<li class="chapter" data-level="8.3.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation"><i class="fa fa-check"></i><b>8.3.2</b> Documentation</a></li>
<li class="chapter" data-level="8.3.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#how-to-install"><i class="fa fa-check"></i><b>8.3.3</b> How to Install</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#methods-library"><i class="fa fa-check"></i><b>8.4</b> Methods Library</a><ul>
<li class="chapter" data-level="8.4.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#support-for-large-scale-analytics"><i class="fa fa-check"></i><b>8.4.1</b> Support for Large-Scale Analytics</a></li>
<li class="chapter" data-level="8.4.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#BigDataSupport"><i class="fa fa-check"></i><b>8.4.2</b> Support for Big Data</a></li>
<li class="chapter" data-level="8.4.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation-1"><i class="fa fa-check"></i><b>8.4.3</b> Documentation</a></li>
<li class="chapter" data-level="8.4.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#system-requirements"><i class="fa fa-check"></i><b>8.4.4</b> System Requirements</a></li>
<li class="chapter" data-level="8.4.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#installR"><i class="fa fa-check"></i><b>8.4.5</b> How to Install</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#deployment-strategies"><i class="fa fa-check"></i><b>8.5</b> Deployment Strategies</a><ul>
<li class="chapter" data-level="8.5.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#broadsea"><i class="fa fa-check"></i><b>8.5.1</b> Broadsea</a></li>
<li class="chapter" data-level="8.5.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#amazon-aws"><i class="fa fa-check"></i><b>8.5.2</b> Amazon AWS</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#summary-6"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="SqlAndR.html"><a href="SqlAndR.html"><i class="fa fa-check"></i><b>9</b> SQL and R</a><ul>
<li class="chapter" data-level="9.1" data-path="SqlAndR.html"><a href="SqlAndR.html#SqlRender"><i class="fa fa-check"></i><b>9.1</b> SqlRender</a><ul>
<li class="chapter" data-level="9.1.1" data-path="SqlAndR.html"><a href="SqlAndR.html#sql-parameterization"><i class="fa fa-check"></i><b>9.1.1</b> SQL Parameterization</a></li>
<li class="chapter" data-level="9.1.2" data-path="SqlAndR.html"><a href="SqlAndR.html#translation-to-other-sql-dialects"><i class="fa fa-check"></i><b>9.1.2</b> Translation to Other SQL Dialects</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="SqlAndR.html"><a href="SqlAndR.html#DatabaseConnector"><i class="fa fa-check"></i><b>9.2</b> DatabaseConnector</a><ul>
<li class="chapter" data-level="9.2.1" data-path="SqlAndR.html"><a href="SqlAndR.html#creating-a-connection"><i class="fa fa-check"></i><b>9.2.1</b> Creating a Connection</a></li>
<li class="chapter" data-level="9.2.2" data-path="SqlAndR.html"><a href="SqlAndR.html#querying"><i class="fa fa-check"></i><b>9.2.2</b> Querying</a></li>
<li class="chapter" data-level="9.2.3" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-using-ffdf-objects"><i class="fa fa-check"></i><b>9.2.3</b> Querying Using Ffdf Objects</a></li>
<li class="chapter" data-level="9.2.4" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-different-platforms-using-the-same-sql"><i class="fa fa-check"></i><b>9.2.4</b> Querying Different Platforms Using the Same SQL</a></li>
<li class="chapter" data-level="9.2.5" data-path="SqlAndR.html"><a href="SqlAndR.html#inserting-tables"><i class="fa fa-check"></i><b>9.2.5</b> Inserting Tables</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="SqlAndR.html"><a href="SqlAndR.html#QueryTheCdm"><i class="fa fa-check"></i><b>9.3</b> Querying the CDM</a></li>
<li class="chapter" data-level="9.4" data-path="SqlAndR.html"><a href="SqlAndR.html#using-the-vocabulary-when-querying"><i class="fa fa-check"></i><b>9.4</b> Using the Vocabulary When Querying</a></li>
<li class="chapter" data-level="9.5" data-path="SqlAndR.html"><a href="SqlAndR.html#querylibrary"><i class="fa fa-check"></i><b>9.5</b> QueryLibrary</a></li>
<li class="chapter" data-level="9.6" data-path="SqlAndR.html"><a href="SqlAndR.html#designing-a-simple-study"><i class="fa fa-check"></i><b>9.6</b> Designing a Simple Study</a><ul>
<li class="chapter" data-level="9.6.1" data-path="SqlAndR.html"><a href="SqlAndR.html#problem-definition"><i class="fa fa-check"></i><b>9.6.1</b> Problem Definition</a></li>
<li class="chapter" data-level="9.6.2" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure"><i class="fa fa-check"></i><b>9.6.2</b> Exposure</a></li>
<li class="chapter" data-level="9.6.3" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome"><i class="fa fa-check"></i><b>9.6.3</b> Outcome</a></li>
<li class="chapter" data-level="9.6.4" data-path="SqlAndR.html"><a href="SqlAndR.html#time-at-risk"><i class="fa fa-check"></i><b>9.6.4</b> Time-At-Risk</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="SqlAndR.html"><a href="SqlAndR.html#implementing-the-study-using-sql-and-r"><i class="fa fa-check"></i><b>9.7</b> Implementing the Study Using SQL and R</a><ul>
<li class="chapter" data-level="9.7.1" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure-cohort"><i class="fa fa-check"></i><b>9.7.1</b> Exposure Cohort</a></li>
<li class="chapter" data-level="9.7.2" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome-cohort"><i class="fa fa-check"></i><b>9.7.2</b> Outcome Cohort</a></li>
<li class="chapter" data-level="9.7.3" data-path="SqlAndR.html"><a href="SqlAndR.html#incidence-rate-calculation"><i class="fa fa-check"></i><b>9.7.3</b> Incidence Rate Calculation</a></li>
<li class="chapter" data-level="9.7.4" data-path="SqlAndR.html"><a href="SqlAndR.html#clean-up"><i class="fa fa-check"></i><b>9.7.4</b> Clean Up</a></li>
<li class="chapter" data-level="9.7.5" data-path="SqlAndR.html"><a href="SqlAndR.html#compatibility"><i class="fa fa-check"></i><b>9.7.5</b> Compatibility</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="SqlAndR.html"><a href="SqlAndR.html#summary-7"><i class="fa fa-check"></i><b>9.8</b> Summary</a></li>
<li class="chapter" data-level="9.9" data-path="SqlAndR.html"><a href="SqlAndR.html#exercises-4"><i class="fa fa-check"></i><b>9.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="Cohorts.html"><a href="Cohorts.html"><i class="fa fa-check"></i><b>10</b> Defining Cohorts</a><ul>
<li class="chapter" data-level="10.1" data-path="Cohorts.html"><a href="Cohorts.html#what-is-a-cohort"><i class="fa fa-check"></i><b>10.1</b> What Is a Cohort?</a></li>
<li class="chapter" data-level="10.2" data-path="Cohorts.html"><a href="Cohorts.html#rule-based-cohort-definitions"><i class="fa fa-check"></i><b>10.2</b> Rule-Based Cohort Definitions</a></li>
<li class="chapter" data-level="10.3" data-path="Cohorts.html"><a href="Cohorts.html#conceptSets"><i class="fa fa-check"></i><b>10.3</b> Concept Sets</a></li>
<li class="chapter" data-level="10.4" data-path="Cohorts.html"><a href="Cohorts.html#probabilistic-cohort-definitions"><i class="fa fa-check"></i><b>10.4</b> Probabilistic Cohort Definitions</a></li>
<li class="chapter" data-level="10.5" data-path="Cohorts.html"><a href="Cohorts.html#cohort-definition-validity"><i class="fa fa-check"></i><b>10.5</b> Cohort Definition Validity</a><ul>
<li class="chapter" data-level="10.5.1" data-path="Cohorts.html"><a href="Cohorts.html#ohdsi-gold-standard-phenotype-library"><i class="fa fa-check"></i><b>10.5.1</b> OHDSI Gold Standard Phenotype Library</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="Cohorts.html"><a href="Cohorts.html#defining-a-cohort-for-hypertension"><i class="fa fa-check"></i><b>10.6</b> Defining a Cohort for Hypertension</a></li>
<li class="chapter" data-level="10.7" data-path="Cohorts.html"><a href="Cohorts.html#implementing-a-cohort-using-atlas"><i class="fa fa-check"></i><b>10.7</b> Implementing a Cohort Using ATLAS</a><ul>
<li class="chapter" data-level="10.7.1" data-path="Cohorts.html"><a href="Cohorts.html#initial-event-criteria"><i class="fa fa-check"></i><b>10.7.1</b> Initial Event Criteria</a></li>
<li class="chapter" data-level="10.7.2" data-path="Cohorts.html"><a href="Cohorts.html#defining-the-concept-set"><i class="fa fa-check"></i><b>10.7.2</b> Defining the Concept Set</a></li>
<li class="chapter" data-level="10.7.3" data-path="Cohorts.html"><a href="Cohorts.html#additional-initial-event-criteria"><i class="fa fa-check"></i><b>10.7.3</b> Additional Initial Event Criteria</a></li>
<li class="chapter" data-level="10.7.4" data-path="Cohorts.html"><a href="Cohorts.html#inclusion-criteria"><i class="fa fa-check"></i><b>10.7.4</b> Inclusion Criteria</a></li>
<li class="chapter" data-level="10.7.5" data-path="Cohorts.html"><a href="Cohorts.html#cohort-exit-criteria"><i class="fa fa-check"></i><b>10.7.5</b> Cohort Exit Criteria</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="Cohorts.html"><a href="Cohorts.html#implementing-the-cohort-using-sql"><i class="fa fa-check"></i><b>10.8</b> Implementing the Cohort Using SQL</a><ul>
<li class="chapter" data-level="10.8.1" data-path="Cohorts.html"><a href="Cohorts.html#connecting-to-the-database"><i class="fa fa-check"></i><b>10.8.1</b> Connecting to the Database</a></li>
<li class="chapter" data-level="10.8.2" data-path="Cohorts.html"><a href="Cohorts.html#specifying-the-concepts"><i class="fa fa-check"></i><b>10.8.2</b> Specifying the Concepts</a></li>
<li class="chapter" data-level="10.8.3" data-path="Cohorts.html"><a href="Cohorts.html#finding-first-use"><i class="fa fa-check"></i><b>10.8.3</b> Finding First Use</a></li>
<li class="chapter" data-level="10.8.4" data-path="Cohorts.html"><a href="Cohorts.html#require-365-days-of-prior-observation"><i class="fa fa-check"></i><b>10.8.4</b> Require 365 Days of Prior Observation</a></li>
<li class="chapter" data-level="10.8.5" data-path="Cohorts.html"><a href="Cohorts.html#require-prior-hypertension"><i class="fa fa-check"></i><b>10.8.5</b> Require Prior Hypertension</a></li>
<li class="chapter" data-level="10.8.6" data-path="Cohorts.html"><a href="Cohorts.html#no-prior-treatment"><i class="fa fa-check"></i><b>10.8.6</b> No Prior Treatment</a></li>
<li class="chapter" data-level="10.8.7" data-path="Cohorts.html"><a href="Cohorts.html#monotherapy"><i class="fa fa-check"></i><b>10.8.7</b> Monotherapy</a></li>
<li class="chapter" data-level="10.8.8" data-path="Cohorts.html"><a href="Cohorts.html#cohort-exit"><i class="fa fa-check"></i><b>10.8.8</b> Cohort Exit</a></li>
<li class="chapter" data-level="10.8.9" data-path="Cohorts.html"><a href="Cohorts.html#cleanup"><i class="fa fa-check"></i><b>10.8.9</b> Cleanup</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="Cohorts.html"><a href="Cohorts.html#summary-8"><i class="fa fa-check"></i><b>10.9</b> Summary</a></li>
<li class="chapter" data-level="10.10" data-path="Cohorts.html"><a href="Cohorts.html#exercises-5"><i class="fa fa-check"></i><b>10.10</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Characterization.html"><a href="Characterization.html"><i class="fa fa-check"></i><b>11</b> Characterization</a><ul>
<li class="chapter" data-level="11.1" data-path="Characterization.html"><a href="Characterization.html#database-level-characterization"><i class="fa fa-check"></i><b>11.1</b> Database Level Characterization</a></li>
<li class="chapter" data-level="11.2" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization"><i class="fa fa-check"></i><b>11.2</b> Cohort Characterization</a></li>
<li class="chapter" data-level="11.3" data-path="Characterization.html"><a href="Characterization.html#treatment-pathways"><i class="fa fa-check"></i><b>11.3</b> Treatment Pathways</a></li>
<li class="chapter" data-level="11.4" data-path="Characterization.html"><a href="Characterization.html#incidence"><i class="fa fa-check"></i><b>11.4</b> Incidence</a></li>
<li class="chapter" data-level="11.5" data-path="Characterization.html"><a href="Characterization.html#characterizing-hypertensive-persons"><i class="fa fa-check"></i><b>11.5</b> Characterizing Hypertensive Persons</a></li>
<li class="chapter" data-level="11.6" data-path="Characterization.html"><a href="Characterization.html#database-characterization-in-atlas"><i class="fa fa-check"></i><b>11.6</b> Database Characterization in ATLAS</a></li>
<li class="chapter" data-level="11.7" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization-in-atlas"><i class="fa fa-check"></i><b>11.7</b> Cohort Characterization in ATLAS</a><ul>
<li class="chapter" data-level="11.7.1" data-path="Characterization.html"><a href="Characterization.html#design"><i class="fa fa-check"></i><b>11.7.1</b> Design</a></li>
<li class="chapter" data-level="11.7.2" data-path="Characterization.html"><a href="Characterization.html#executions"><i class="fa fa-check"></i><b>11.7.2</b> Executions</a></li>
<li class="chapter" data-level="11.7.3" data-path="Characterization.html"><a href="Characterization.html#results"><i class="fa fa-check"></i><b>11.7.3</b> Results</a></li>
<li class="chapter" data-level="11.7.4" data-path="Characterization.html"><a href="Characterization.html#defining-custom-features"><i class="fa fa-check"></i><b>11.7.4</b> Defining Custom Features</a></li>
</ul></li>
<li class="chapter" data-level="11.8" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization-in-r"><i class="fa fa-check"></i><b>11.8</b> Cohort Characterization in R</a><ul>
<li class="chapter" data-level="11.8.1" data-path="Characterization.html"><a href="Characterization.html#cohort-instantiation"><i class="fa fa-check"></i><b>11.8.1</b> Cohort Instantiation</a></li>
<li class="chapter" data-level="11.8.2" data-path="Characterization.html"><a href="Characterization.html#data-extraction"><i class="fa fa-check"></i><b>11.8.2</b> Data Extraction</a></li>
<li class="chapter" data-level="11.8.3" data-path="Characterization.html"><a href="Characterization.html#using-prespecified-analyses"><i class="fa fa-check"></i><b>11.8.3</b> Using Prespecified Analyses</a></li>
<li class="chapter" data-level="11.8.4" data-path="Characterization.html"><a href="Characterization.html#creating-aggregated-covariates"><i class="fa fa-check"></i><b>11.8.4</b> Creating Aggregated Covariates</a></li>
<li class="chapter" data-level="11.8.5" data-path="Characterization.html"><a href="Characterization.html#output-format"><i class="fa fa-check"></i><b>11.8.5</b> Output Format</a></li>
<li class="chapter" data-level="11.8.6" data-path="Characterization.html"><a href="Characterization.html#custom-covariates"><i class="fa fa-check"></i><b>11.8.6</b> Custom Covariates</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="Characterization.html"><a href="Characterization.html#cohort-pathways-in-atlas"><i class="fa fa-check"></i><b>11.9</b> Cohort Pathways in ATLAS</a><ul>
<li class="chapter" data-level="11.9.1" data-path="Characterization.html"><a href="Characterization.html#design-1"><i class="fa fa-check"></i><b>11.9.1</b> Design</a></li>
<li class="chapter" data-level="11.9.2" data-path="Characterization.html"><a href="Characterization.html#executions-1"><i class="fa fa-check"></i><b>11.9.2</b> Executions</a></li>
<li class="chapter" data-level="11.9.3" data-path="Characterization.html"><a href="Characterization.html#viewing-results"><i class="fa fa-check"></i><b>11.9.3</b> Viewing Results</a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="Characterization.html"><a href="Characterization.html#incidence-analysis-in-atlas"><i class="fa fa-check"></i><b>11.10</b> Incidence Analysis in ATLAS</a><ul>
<li class="chapter" data-level="11.10.1" data-path="Characterization.html"><a href="Characterization.html#design-2"><i class="fa fa-check"></i><b>11.10.1</b> Design</a></li>
<li class="chapter" data-level="11.10.2" data-path="Characterization.html"><a href="Characterization.html#executions-2"><i class="fa fa-check"></i><b>11.10.2</b> Executions</a></li>
<li class="chapter" data-level="11.10.3" data-path="Characterization.html"><a href="Characterization.html#viewing-results-1"><i class="fa fa-check"></i><b>11.10.3</b> Viewing Results</a></li>
</ul></li>
<li class="chapter" data-level="11.11" data-path="Characterization.html"><a href="Characterization.html#summary-9"><i class="fa fa-check"></i><b>11.11</b> Summary</a></li>
<li class="chapter" data-level="11.12" data-path="Characterization.html"><a href="Characterization.html#exercises-6"><i class="fa fa-check"></i><b>11.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html"><i class="fa fa-check"></i><b>12</b> Population-Level Estimation</a><ul>
<li class="chapter" data-level="12.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#CohortMethod"><i class="fa fa-check"></i><b>12.1</b> The Cohort Method Design</a><ul>
<li class="chapter" data-level="12.1.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores"><i class="fa fa-check"></i><b>12.1.1</b> Propensity Scores</a></li>
<li class="chapter" data-level="12.1.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#VariableSelection"><i class="fa fa-check"></i><b>12.1.2</b> Variable Selection</a></li>
<li class="chapter" data-level="12.1.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#caliper"><i class="fa fa-check"></i><b>12.1.3</b> Caliper</a></li>
<li class="chapter" data-level="12.1.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#overlap-preference-scores"><i class="fa fa-check"></i><b>12.1.4</b> Overlap: Preference Scores</a></li>
<li class="chapter" data-level="12.1.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#balance"><i class="fa fa-check"></i><b>12.1.5</b> Balance</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-cohort-design"><i class="fa fa-check"></i><b>12.2</b> The Self-Controlled Cohort Design</a></li>
<li class="chapter" data-level="12.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-control-design"><i class="fa fa-check"></i><b>12.3</b> The Case-Control Design</a></li>
<li class="chapter" data-level="12.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-crossover-design"><i class="fa fa-check"></i><b>12.4</b> The Case-Crossover Design</a></li>
<li class="chapter" data-level="12.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-case-series-design"><i class="fa fa-check"></i><b>12.5</b> The Self-Controlled Case Series Design</a></li>
<li class="chapter" data-level="12.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#designing-a-hypertension-study"><i class="fa fa-check"></i><b>12.6</b> Designing a Hypertension Study</a><ul>
<li class="chapter" data-level="12.6.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#problem-definition-1"><i class="fa fa-check"></i><b>12.6.1</b> Problem Definition</a></li>
<li class="chapter" data-level="12.6.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#target-and-comparator"><i class="fa fa-check"></i><b>12.6.2</b> Target and Comparator</a></li>
<li class="chapter" data-level="12.6.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-1"><i class="fa fa-check"></i><b>12.6.3</b> Outcome</a></li>
<li class="chapter" data-level="12.6.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#time-at-risk-1"><i class="fa fa-check"></i><b>12.6.4</b> Time-At-Risk</a></li>
<li class="chapter" data-level="12.6.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#model"><i class="fa fa-check"></i><b>12.6.5</b> Model</a></li>
<li class="chapter" data-level="12.6.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#study-summary"><i class="fa fa-check"></i><b>12.6.6</b> Study Summary</a></li>
<li class="chapter" data-level="12.6.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#control-questions"><i class="fa fa-check"></i><b>12.6.7</b> Control Questions</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#PleAtlas"><i class="fa fa-check"></i><b>12.7</b> Implementing the Study Using ATLAS</a><ul>
<li class="chapter" data-level="12.7.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ComparisonSettings"><i class="fa fa-check"></i><b>12.7.1</b> Comparative Cohort Settings</a></li>
<li class="chapter" data-level="12.7.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-estimation-analysis-settings"><i class="fa fa-check"></i><b>12.7.2</b> Effect Estimation Analysis Settings</a></li>
<li class="chapter" data-level="12.7.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#evaluationSettings"><i class="fa fa-check"></i><b>12.7.3</b> Evaluation Settings</a></li>
<li class="chapter" data-level="12.7.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#running-the-study-package"><i class="fa fa-check"></i><b>12.7.4</b> Running the Study Package</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#pleR"><i class="fa fa-check"></i><b>12.8</b> Implementing the Study Using R</a><ul>
<li class="chapter" data-level="12.8.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#cohort-instantiation-1"><i class="fa fa-check"></i><b>12.8.1</b> Cohort Instantiation</a></li>
<li class="chapter" data-level="12.8.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#data-extraction-1"><i class="fa fa-check"></i><b>12.8.2</b> Data Extraction</a></li>
<li class="chapter" data-level="12.8.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#defining-the-study-population"><i class="fa fa-check"></i><b>12.8.3</b> Defining the Study Population</a></li>
<li class="chapter" data-level="12.8.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-1"><i class="fa fa-check"></i><b>12.8.4</b> Propensity Scores</a></li>
<li class="chapter" data-level="12.8.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-models"><i class="fa fa-check"></i><b>12.8.5</b> Outcome Models</a></li>
<li class="chapter" data-level="12.8.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#MultipleAnalyses"><i class="fa fa-check"></i><b>12.8.6</b> Running Multiple Analyses</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#studyOutputs"><i class="fa fa-check"></i><b>12.9</b> Study Outputs</a><ul>
<li class="chapter" data-level="12.9.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-and-model"><i class="fa fa-check"></i><b>12.9.1</b> Propensity Scores and Model</a></li>
<li class="chapter" data-level="12.9.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#covariate-balance"><i class="fa fa-check"></i><b>12.9.2</b> Covariate Balance</a></li>
<li class="chapter" data-level="12.9.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#follow-up-and-power"><i class="fa fa-check"></i><b>12.9.3</b> Follow Up and Power</a></li>
<li class="chapter" data-level="12.9.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#kaplan-meier"><i class="fa fa-check"></i><b>12.9.4</b> Kaplan-Meier</a></li>
<li class="chapter" data-level="12.9.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-size-estimate"><i class="fa fa-check"></i><b>12.9.5</b> Effect Size Estimate</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#summary-10"><i class="fa fa-check"></i><b>12.10</b> Summary</a></li>
<li class="chapter" data-level="12.11" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#exercises-7"><i class="fa fa-check"></i><b>12.11</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html"><i class="fa fa-check"></i><b>13</b> Patient-Level Prediction</a><ul>
<li class="chapter" data-level="13.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#the-prediction-problem"><i class="fa fa-check"></i><b>13.1</b> The Prediction Problem</a></li>
<li class="chapter" data-level="13.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-2"><i class="fa fa-check"></i><b>13.2</b> Data Extraction</a><ul>
<li class="chapter" data-level="13.2.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-example"><i class="fa fa-check"></i><b>13.2.1</b> Data Extraction Example</a></li>
<li class="chapter" data-level="13.2.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#negative-vs-missing"><i class="fa fa-check"></i><b>13.2.2</b> Negative vs Missing</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#modelFitting"><i class="fa fa-check"></i><b>13.3</b> Fitting the Model</a><ul>
<li class="chapter" data-level="13.3.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#regularized-logistic-regression"><i class="fa fa-check"></i><b>13.3.1</b> Regularized Logistic Regression</a></li>
<li class="chapter" data-level="13.3.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#gradient-boosting-machines"><i class="fa fa-check"></i><b>13.3.2</b> Gradient Boosting Machines</a></li>
<li class="chapter" data-level="13.3.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#random-forest"><i class="fa fa-check"></i><b>13.3.3</b> Random Forest</a></li>
<li class="chapter" data-level="13.3.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>13.3.4</b> K-Nearest Neighbors</a></li>
<li class="chapter" data-level="13.3.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#naive-bayes"><i class="fa fa-check"></i><b>13.3.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="13.3.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#adaboost"><i class="fa fa-check"></i><b>13.3.6</b> AdaBoost</a></li>
<li class="chapter" data-level="13.3.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#decision-tree"><i class="fa fa-check"></i><b>13.3.7</b> Decision Tree</a></li>
<li class="chapter" data-level="13.3.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#multilayer-perceptron"><i class="fa fa-check"></i><b>13.3.8</b> Multilayer Perceptron</a></li>
<li class="chapter" data-level="13.3.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#deep-learning"><i class="fa fa-check"></i><b>13.3.9</b> Deep Learning</a></li>
<li class="chapter" data-level="13.3.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#other-algorithms"><i class="fa fa-check"></i><b>13.3.10</b> Other Algorithms</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evaluating-prediction-models"><i class="fa fa-check"></i><b>13.4</b> Evaluating Prediction Models</a><ul>
<li class="chapter" data-level="13.4.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evaluation-types"><i class="fa fa-check"></i><b>13.4.1</b> Evaluation Types</a></li>
<li class="chapter" data-level="13.4.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#performance"><i class="fa fa-check"></i><b>13.4.2</b> Performance Metrics</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#designing-a-patient-level-prediction-study"><i class="fa fa-check"></i><b>13.5</b> Designing a Patient-Level Prediction Study</a><ul>
<li class="chapter" data-level="13.5.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#problem-definition-3"><i class="fa fa-check"></i><b>13.5.1</b> Problem Definition</a></li>
<li class="chapter" data-level="13.5.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-population-definition"><i class="fa fa-check"></i><b>13.5.2</b> Study Population Definition</a></li>
<li class="chapter" data-level="13.5.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development-settings"><i class="fa fa-check"></i><b>13.5.3</b> Model Development Settings</a></li>
<li class="chapter" data-level="13.5.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-evaluation"><i class="fa fa-check"></i><b>13.5.4</b> Model Evaluation</a></li>
<li class="chapter" data-level="13.5.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-summary-1"><i class="fa fa-check"></i><b>13.5.5</b> Study Summary</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-atlas"><i class="fa fa-check"></i><b>13.6</b> Implementing the Study in ATLAS</a><ul>
<li class="chapter" data-level="13.6.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#prediction-problem-settings"><i class="fa fa-check"></i><b>13.6.1</b> Prediction Problem Settings</a></li>
<li class="chapter" data-level="13.6.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#analysis-settings"><i class="fa fa-check"></i><b>13.6.2</b> Analysis Settings</a></li>
<li class="chapter" data-level="13.6.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#execution-settings"><i class="fa fa-check"></i><b>13.6.3</b> Execution Settings</a></li>
<li class="chapter" data-level="13.6.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#training-settings"><i class="fa fa-check"></i><b>13.6.4</b> Training Settings</a></li>
<li class="chapter" data-level="13.6.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#importing-and-exporting-a-study"><i class="fa fa-check"></i><b>13.6.5</b> Importing and Exporting a Study</a></li>
<li class="chapter" data-level="13.6.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#downloading-the-study-package"><i class="fa fa-check"></i><b>13.6.6</b> Downloading the Study Package</a></li>
<li class="chapter" data-level="13.6.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#running-the-study"><i class="fa fa-check"></i><b>13.6.7</b> Running the Study</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-r"><i class="fa fa-check"></i><b>13.7</b> Implementing the Study in R</a><ul>
<li class="chapter" data-level="13.7.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#cohort-instantiation-2"><i class="fa fa-check"></i><b>13.7.1</b> Cohort Instantiation</a></li>
<li class="chapter" data-level="13.7.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-3"><i class="fa fa-check"></i><b>13.7.2</b> Data Extraction</a></li>
<li class="chapter" data-level="13.7.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-inclusion-criteria"><i class="fa fa-check"></i><b>13.7.3</b> Additional Inclusion Criteria</a></li>
<li class="chapter" data-level="13.7.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development"><i class="fa fa-check"></i><b>13.7.4</b> Model Development</a></li>
<li class="chapter" data-level="13.7.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#internal-validation"><i class="fa fa-check"></i><b>13.7.5</b> Internal Validation</a></li>
<li class="chapter" data-level="13.7.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#external-validation"><i class="fa fa-check"></i><b>13.7.6</b> External Validation</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#results-dissemination"><i class="fa fa-check"></i><b>13.8</b> Results Dissemination</a><ul>
<li class="chapter" data-level="13.8.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-performance"><i class="fa fa-check"></i><b>13.8.1</b> Model Performance</a></li>
<li class="chapter" data-level="13.8.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#comparing-models"><i class="fa fa-check"></i><b>13.8.2</b> Comparing Models</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-patient-level-prediction-features"><i class="fa fa-check"></i><b>13.9</b> Additional Patient-Level Prediction Features</a><ul>
<li class="chapter" data-level="13.9.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#journal-paper-generation"><i class="fa fa-check"></i><b>13.9.1</b> Journal Paper Generation</a></li>
</ul></li>
<li class="chapter" data-level="13.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#summary-11"><i class="fa fa-check"></i><b>13.10</b> Summary</a></li>
<li class="chapter" data-level="13.11" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#exercises-8"><i class="fa fa-check"></i><b>13.11</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>IV Evidence Quality</b></span></li>
<li class="chapter" data-level="14" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html"><i class="fa fa-check"></i><b>14</b> Evidence Quality</a><ul>
<li class="chapter" data-level="14.1" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#attributes-of-reliable-evidence"><i class="fa fa-check"></i><b>14.1</b> Attributes of Reliable Evidence</a></li>
<li class="chapter" data-level="14.2" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#understanding-evidence-quality"><i class="fa fa-check"></i><b>14.2</b> Understanding Evidence Quality</a></li>
<li class="chapter" data-level="14.3" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#communicating-evidence-quality"><i class="fa fa-check"></i><b>14.3</b> Communicating Evidence Quality</a></li>
<li class="chapter" data-level="14.4" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#summary-12"><i class="fa fa-check"></i><b>14.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="DataQuality.html"><a href="DataQuality.html"><i class="fa fa-check"></i><b>15</b> Data Quality</a><ul>
<li class="chapter" data-level="15.1" data-path="DataQuality.html"><a href="DataQuality.html#sources-of-data-quality-problems"><i class="fa fa-check"></i><b>15.1</b> Sources of Data Quality Problems</a></li>
<li class="chapter" data-level="15.2" data-path="DataQuality.html"><a href="DataQuality.html#data-quality-in-general"><i class="fa fa-check"></i><b>15.2</b> Data Quality in General</a><ul>
<li class="chapter" data-level="15.2.1" data-path="DataQuality.html"><a href="DataQuality.html#data-quality-checks"><i class="fa fa-check"></i><b>15.2.1</b> Data Quality Checks</a></li>
<li class="chapter" data-level="15.2.2" data-path="DataQuality.html"><a href="DataQuality.html#etlUnitTests"><i class="fa fa-check"></i><b>15.2.2</b> ETL Unit Tests</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="DataQuality.html"><a href="DataQuality.html#study-specific-checks"><i class="fa fa-check"></i><b>15.3</b> Study-Specific Checks</a><ul>
<li class="chapter" data-level="15.3.1" data-path="DataQuality.html"><a href="DataQuality.html#checking-mappings"><i class="fa fa-check"></i><b>15.3.1</b> Checking Mappings</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="DataQuality.html"><a href="DataQuality.html#achillesInPractice"><i class="fa fa-check"></i><b>15.4</b> ACHILLES in Practice</a></li>
<li class="chapter" data-level="15.5" data-path="DataQuality.html"><a href="DataQuality.html#dqdInPractice"><i class="fa fa-check"></i><b>15.5</b> Data Quality Dashboard in Practice</a></li>
<li class="chapter" data-level="15.6" data-path="DataQuality.html"><a href="DataQuality.html#study-specific-checks-in-practice"><i class="fa fa-check"></i><b>15.6</b> Study-Specific Checks in Practice</a></li>
<li class="chapter" data-level="15.7" data-path="DataQuality.html"><a href="DataQuality.html#summary-13"><i class="fa fa-check"></i><b>15.7</b> Summary</a></li>
<li class="chapter" data-level="15.8" data-path="DataQuality.html"><a href="DataQuality.html#exercises-9"><i class="fa fa-check"></i><b>15.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html"><i class="fa fa-check"></i><b>16</b> Clinical Validity</a><ul>
<li class="chapter" data-level="16.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#CharacteristicsOfDatabase"><i class="fa fa-check"></i><b>16.1</b> Characteristics of Health Care Databases</a></li>
<li class="chapter" data-level="16.2" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#CohortValidation"><i class="fa fa-check"></i><b>16.2</b> Cohort Validation</a><ul>
<li class="chapter" data-level="16.2.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#cohort-evaluation-metrics"><i class="fa fa-check"></i><b>16.2.1</b> Cohort Evaluation Metrics</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#source-record-verification"><i class="fa fa-check"></i><b>16.3</b> Source Record Verification</a><ul>
<li class="chapter" data-level="16.3.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#example-of-source-record-verification"><i class="fa fa-check"></i><b>16.3.1</b> Example of Source Record Verification</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#phevaluator"><i class="fa fa-check"></i><b>16.4</b> PheValuator</a><ul>
<li class="chapter" data-level="16.4.1" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#example-validation-by-phevaluator"><i class="fa fa-check"></i><b>16.4.1</b> Example Validation By PheValuator</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#GeneralizabilityOfEvidence"><i class="fa fa-check"></i><b>16.5</b> Generalizability of the Evidence</a></li>
<li class="chapter" data-level="16.6" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html#summary-14"><i class="fa fa-check"></i><b>16.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html"><i class="fa fa-check"></i><b>17</b> Software Validity</a><ul>
<li class="chapter" data-level="17.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#study-code-validity"><i class="fa fa-check"></i><b>17.1</b> Study Code Validity</a><ul>
<li class="chapter" data-level="17.1.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#automation"><i class="fa fa-check"></i><b>17.1.1</b> Automation As a Requirement for Reproducibility</a></li>
<li class="chapter" data-level="17.1.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#programming-best-practices"><i class="fa fa-check"></i><b>17.1.2</b> Programming Best Practices</a></li>
<li class="chapter" data-level="17.1.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#code-validation"><i class="fa fa-check"></i><b>17.1.3</b> Code Validation</a></li>
<li class="chapter" data-level="17.1.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#using-the-methods-library"><i class="fa fa-check"></i><b>17.1.4</b> Using the Methods Library</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-software-development-process"><i class="fa fa-check"></i><b>17.2</b> Methods Library Software Development Process</a><ul>
<li class="chapter" data-level="17.2.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#source-code-management"><i class="fa fa-check"></i><b>17.2.1</b> Source Code Management</a></li>
<li class="chapter" data-level="17.2.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#documentation-2"><i class="fa fa-check"></i><b>17.2.2</b> Documentation</a></li>
<li class="chapter" data-level="17.2.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#availability-of-current-and-historical-archive-versions"><i class="fa fa-check"></i><b>17.2.3</b> Availability of Current and Historical Archive Versions</a></li>
<li class="chapter" data-level="17.2.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#maintenance-support-and-retirement"><i class="fa fa-check"></i><b>17.2.4</b> Maintenance, Support and Retirement</a></li>
<li class="chapter" data-level="17.2.5" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#qualified-personnel"><i class="fa fa-check"></i><b>17.2.5</b> Qualified Personnel</a></li>
<li class="chapter" data-level="17.2.6" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#physical-and-logical-security"><i class="fa fa-check"></i><b>17.2.6</b> Physical and Logical Security</a></li>
<li class="chapter" data-level="17.2.7" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#disaster-recovery"><i class="fa fa-check"></i><b>17.2.7</b> Disaster Recovery</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-testing"><i class="fa fa-check"></i><b>17.3</b> Methods Library Testing</a><ul>
<li class="chapter" data-level="17.3.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#unit-test"><i class="fa fa-check"></i><b>17.3.1</b> Unit Test</a></li>
<li class="chapter" data-level="17.3.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#simulation"><i class="fa fa-check"></i><b>17.3.2</b> Simulation</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#summary-15"><i class="fa fa-check"></i><b>17.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="MethodValidity.html"><a href="MethodValidity.html"><i class="fa fa-check"></i><b>18</b> Method Validity</a><ul>
<li class="chapter" data-level="18.1" data-path="MethodValidity.html"><a href="MethodValidity.html#design-specific-diagnostics"><i class="fa fa-check"></i><b>18.1</b> Design-Specific Diagnostics</a></li>
<li class="chapter" data-level="18.2" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-all-estimation"><i class="fa fa-check"></i><b>18.2</b> Diagnostics for All Estimation</a><ul>
<li class="chapter" data-level="18.2.1" data-path="MethodValidity.html"><a href="MethodValidity.html#NegativeControls"><i class="fa fa-check"></i><b>18.2.1</b> Negative Controls</a></li>
<li class="chapter" data-level="18.2.2" data-path="MethodValidity.html"><a href="MethodValidity.html#PositiveControls"><i class="fa fa-check"></i><b>18.2.2</b> Positive Controls</a></li>
<li class="chapter" data-level="18.2.3" data-path="MethodValidity.html"><a href="MethodValidity.html#metrics"><i class="fa fa-check"></i><b>18.2.3</b> Empirical Evaluation</a></li>
<li class="chapter" data-level="18.2.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration"><i class="fa fa-check"></i><b>18.2.4</b> P-Value Calibration</a></li>
<li class="chapter" data-level="18.2.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration"><i class="fa fa-check"></i><b>18.2.5</b> Confidence Interval Calibration</a></li>
<li class="chapter" data-level="18.2.6" data-path="MethodValidity.html"><a href="MethodValidity.html#replication-across-sites"><i class="fa fa-check"></i><b>18.2.6</b> Replication Across Sites</a></li>
<li class="chapter" data-level="18.2.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses"><i class="fa fa-check"></i><b>18.2.7</b> Sensitivity Analyses</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="MethodValidity.html"><a href="MethodValidity.html#method-validation-in-practice"><i class="fa fa-check"></i><b>18.3</b> Method Validation in Practice</a><ul>
<li class="chapter" data-level="18.3.1" data-path="MethodValidity.html"><a href="MethodValidity.html#selecting-negative-controls"><i class="fa fa-check"></i><b>18.3.1</b> Selecting Negative Controls</a></li>
<li class="chapter" data-level="18.3.2" data-path="MethodValidity.html"><a href="MethodValidity.html#including-controls"><i class="fa fa-check"></i><b>18.3.2</b> Including Controls</a></li>
<li class="chapter" data-level="18.3.3" data-path="MethodValidity.html"><a href="MethodValidity.html#empirical-performance"><i class="fa fa-check"></i><b>18.3.3</b> Empirical Performance</a></li>
<li class="chapter" data-level="18.3.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration-1"><i class="fa fa-check"></i><b>18.3.4</b> P-Value Calibration</a></li>
<li class="chapter" data-level="18.3.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration-1"><i class="fa fa-check"></i><b>18.3.5</b> Confidence Interval Calibration</a></li>
<li class="chapter" data-level="18.3.6" data-path="MethodValidity.html"><a href="MethodValidity.html#between-database-heterogeneity"><i class="fa fa-check"></i><b>18.3.6</b> Between-Database Heterogeneity</a></li>
<li class="chapter" data-level="18.3.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses-1"><i class="fa fa-check"></i><b>18.3.7</b> Sensitivity Analyses</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="MethodValidity.html"><a href="MethodValidity.html#ohdsi-methods-benchmark"><i class="fa fa-check"></i><b>18.4</b> OHDSI Methods Benchmark</a></li>
<li class="chapter" data-level="18.5" data-path="MethodValidity.html"><a href="MethodValidity.html#summary-16"><i class="fa fa-check"></i><b>18.5</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>V OHDSI Studies</b></span></li>
<li class="chapter" data-level="19" data-path="StudySteps.html"><a href="StudySteps.html"><i class="fa fa-check"></i><b>19</b> Study steps</a><ul>
<li class="chapter" data-level="19.1" data-path="StudySteps.html"><a href="StudySteps.html#general-best-practice-guidelines"><i class="fa fa-check"></i><b>19.1</b> General Best Practice Guidelines</a><ul>
<li class="chapter" data-level="19.1.1" data-path="StudySteps.html"><a href="StudySteps.html#observational-study-definition"><i class="fa fa-check"></i><b>19.1.1</b> Observational Study Definition</a></li>
<li class="chapter" data-level="19.1.2" data-path="StudySteps.html"><a href="StudySteps.html#pre-specification-of-study-design"><i class="fa fa-check"></i><b>19.1.2</b> Pre-Specification of Study Design</a></li>
<li class="chapter" data-level="19.1.3" data-path="StudySteps.html"><a href="StudySteps.html#protocol"><i class="fa fa-check"></i><b>19.1.3</b> Protocol</a></li>
<li class="chapter" data-level="19.1.4" data-path="StudySteps.html"><a href="StudySteps.html#standardized-analyses"><i class="fa fa-check"></i><b>19.1.4</b> Standardized Analyses</a></li>
<li class="chapter" data-level="19.1.5" data-path="StudySteps.html"><a href="StudySteps.html#study-packages"><i class="fa fa-check"></i><b>19.1.5</b> Study Packages</a></li>
<li class="chapter" data-level="19.1.6" data-path="StudySteps.html"><a href="StudySteps.html#the-data-underlying-the-cdm"><i class="fa fa-check"></i><b>19.1.6</b> The Data Underlying the CDM</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="StudySteps.html"><a href="StudySteps.html#study-steps-in-detail"><i class="fa fa-check"></i><b>19.2</b> Study Steps in Detail</a><ul>
<li class="chapter" data-level="19.2.1" data-path="StudySteps.html"><a href="StudySteps.html#define-question"><i class="fa fa-check"></i><b>19.2.1</b> Define Question</a></li>
<li class="chapter" data-level="19.2.2" data-path="StudySteps.html"><a href="StudySteps.html#review-data-availability-and-quality"><i class="fa fa-check"></i><b>19.2.2</b> Review Data Availability and Quality</a></li>
<li class="chapter" data-level="19.2.3" data-path="StudySteps.html"><a href="StudySteps.html#study-populations"><i class="fa fa-check"></i><b>19.2.3</b> Study Populations</a></li>
<li class="chapter" data-level="19.2.4" data-path="StudySteps.html"><a href="StudySteps.html#Feasibility"><i class="fa fa-check"></i><b>19.2.4</b> Feasibility and Diagnostics</a></li>
<li class="chapter" data-level="19.2.5" data-path="StudySteps.html"><a href="StudySteps.html#finalize-protocol-and-study-package"><i class="fa fa-check"></i><b>19.2.5</b> Finalize Protocol and Study Package</a></li>
<li class="chapter" data-level="19.2.6" data-path="StudySteps.html"><a href="StudySteps.html#execute-study"><i class="fa fa-check"></i><b>19.2.6</b> Execute Study</a></li>
<li class="chapter" data-level="19.2.7" data-path="StudySteps.html"><a href="StudySteps.html#interpretation-and-write-up"><i class="fa fa-check"></i><b>19.2.7</b> Interpretation and Write-Up</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="StudySteps.html"><a href="StudySteps.html#summary-17"><i class="fa fa-check"></i><b>19.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="NetworkResearch.html"><a href="NetworkResearch.html"><i class="fa fa-check"></i><b>20</b> OHDSI Network Research</a><ul>
<li class="chapter" data-level="20.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsi-as-a-research-network"><i class="fa fa-check"></i><b>20.1</b> OHDSI as a Research Network</a></li>
<li class="chapter" data-level="20.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsi-network-studies"><i class="fa fa-check"></i><b>20.2</b> OHDSI Network Studies</a><ul>
<li class="chapter" data-level="20.2.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#motivations-for-conducting-an-ohdsi-network-study"><i class="fa fa-check"></i><b>20.2.1</b> Motivations for Conducting an OHDSI Network Study</a></li>
<li class="chapter" data-level="20.2.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#definition-of-an-ohdsi-network-study"><i class="fa fa-check"></i><b>20.2.2</b> Definition of an OHDSI Network Study</a></li>
<li class="chapter" data-level="20.2.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#design-considerations-for-an-ohdsi-network-study"><i class="fa fa-check"></i><b>20.2.3</b> Design Considerations for an OHDSI Network Study</a></li>
<li class="chapter" data-level="20.2.4" data-path="NetworkResearch.html"><a href="NetworkResearch.html#logistical-considerations-for-an-ohdsi-network-study"><i class="fa fa-check"></i><b>20.2.4</b> Logistical Considerations for an OHDSI Network Study</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#running-an-ohdsi-network-study"><i class="fa fa-check"></i><b>20.3</b> Running an OHDSI Network Study</a><ul>
<li class="chapter" data-level="20.3.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#study-design-and-feasibility"><i class="fa fa-check"></i><b>20.3.1</b> Study Design and Feasibility</a></li>
<li class="chapter" data-level="20.3.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#study-execution"><i class="fa fa-check"></i><b>20.3.2</b> Study Execution</a></li>
<li class="chapter" data-level="20.3.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#results-dissemination-and-publication"><i class="fa fa-check"></i><b>20.3.3</b> Results Dissemination and Publication</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="NetworkResearch.html"><a href="NetworkResearch.html#forward-looking-using-network-study-automation"><i class="fa fa-check"></i><b>20.4</b> Forward Looking: Using Network Study Automation</a></li>
<li class="chapter" data-level="20.5" data-path="NetworkResearch.html"><a href="NetworkResearch.html#best-practice-for-ohdsi-network-studies"><i class="fa fa-check"></i><b>20.5</b> Best Practice for OHDSI Network Studies</a></li>
<li class="chapter" data-level="20.6" data-path="NetworkResearch.html"><a href="NetworkResearch.html#summary-18"><i class="fa fa-check"></i><b>20.6</b> Summary</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="Glossary.html"><a href="Glossary.html"><i class="fa fa-check"></i><b>A</b> Glossary</a></li>
<li class="chapter" data-level="B" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html"><i class="fa fa-check"></i><b>B</b> Cohort definitions</a><ul>
<li class="chapter" data-level="B.1" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitors"><i class="fa fa-check"></i><b>B.1</b> ACE Inhibitors</a></li>
<li class="chapter" data-level="B.2" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitorsMono"><i class="fa fa-check"></i><b>B.2</b> New Users of ACE Inhibitors Monotherapy</a></li>
<li class="chapter" data-level="B.3" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Ami"><i class="fa fa-check"></i><b>B.3</b> Acute Myocardial Infarction (AMI)</a></li>
<li class="chapter" data-level="B.4" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Angioedema"><i class="fa fa-check"></i><b>B.4</b> Angioedema</a></li>
<li class="chapter" data-level="B.5" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ThiazidesMono"><i class="fa fa-check"></i><b>B.5</b> New Users of Thiazide-Like Diuretics Monotherapy</a></li>
<li class="chapter" data-level="B.6" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN1yrFO"><i class="fa fa-check"></i><b>B.6</b> Patients Initiating First-Line Therapy for Hypertension</a></li>
<li class="chapter" data-level="B.7" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN3yrFO"><i class="fa fa-check"></i><b>B.7</b> Patients Initiating First-Line Therapy for Hypertension With &gt;3 Yr Follow-Up</a></li>
<li class="chapter" data-level="B.8" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ACEiUse"><i class="fa fa-check"></i><b>B.8</b> ACE Inhibitor Use</a></li>
<li class="chapter" data-level="B.9" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ARBUse"><i class="fa fa-check"></i><b>B.9</b> Angiotensin Receptor Blocker (ARB) Use</a></li>
<li class="chapter" data-level="B.10" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#THZUse"><i class="fa fa-check"></i><b>B.10</b> Thiazide Or Thiazide-Like Diuretic Use</a></li>
<li class="chapter" data-level="B.11" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#dCCBUse"><i class="fa fa-check"></i><b>B.11</b> Dihydropyridine Calcium Channel Blocker (dCCB) Use</a></li>
<li class="chapter" data-level="B.12" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ndCCBUse"><i class="fa fa-check"></i><b>B.12</b> Non-Dihydropyridine Calcium Channel Blocker (ndCCB) Use</a></li>
<li class="chapter" data-level="B.13" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#BBUse"><i class="fa fa-check"></i><b>B.13</b> Beta-Blocker Use</a></li>
<li class="chapter" data-level="B.14" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DLoopUse"><i class="fa fa-check"></i><b>B.14</b> Diuretic-Loop Use</a></li>
<li class="chapter" data-level="B.15" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DPUse"><i class="fa fa-check"></i><b>B.15</b> Diuretic-Potassium Sparing Use</a></li>
<li class="chapter" data-level="B.16" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#A1BUse"><i class="fa fa-check"></i><b>B.16</b> Alpha-1 Blocker Use</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html"><i class="fa fa-check"></i><b>C</b> Negative controls</a><ul>
<li class="chapter" data-level="C.1" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html#AceiThzNsc"><i class="fa fa-check"></i><b>C.1</b> ACEi and THZ</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="ProtocolTemplate.html"><a href="ProtocolTemplate.html"><i class="fa fa-check"></i><b>D</b> Protocol template</a></li>
<li class="chapter" data-level="E" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html"><i class="fa fa-check"></i><b>E</b> Suggested Answers</a><ul>
<li class="chapter" data-level="E.1" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Cdmanswers"><i class="fa fa-check"></i><b>E.1</b> The Common Data Model</a></li>
<li class="chapter" data-level="E.2" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Vocabanswers"><i class="fa fa-check"></i><b>E.2</b> Standardized Vocabularies</a></li>
<li class="chapter" data-level="E.3" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Etlanswers"><i class="fa fa-check"></i><b>E.3</b> Extract Transform Load</a></li>
<li class="chapter" data-level="E.4" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#UseCasesanswers"><i class="fa fa-check"></i><b>E.4</b> Data Analytics Use Cases</a></li>
<li class="chapter" data-level="E.5" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#SqlAndRanswers"><i class="fa fa-check"></i><b>E.5</b> SQL and R</a></li>
<li class="chapter" data-level="E.6" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Cohortsanswers"><i class="fa fa-check"></i><b>E.6</b> Defining Cohorts</a></li>
<li class="chapter" data-level="E.7" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Characterizationanswers"><i class="fa fa-check"></i><b>E.7</b> Characterization</a></li>
<li class="chapter" data-level="E.8" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Pleanswers"><i class="fa fa-check"></i><b>E.8</b> Population-Level Estimation</a></li>
<li class="chapter" data-level="E.9" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#Plpanswers"><i class="fa fa-check"></i><b>E.9</b> Patient-Level Prediction</a></li>
<li class="chapter" data-level="E.10" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#DataQualityanswers"><i class="fa fa-check"></i><b>E.10</b> Data Quality</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Book of OHDSI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SqlAndR" class="section level1">
<h1><span class="header-section-number">Chapter 9</span> SQL and R</h1>
<p><em>Chapter leads: Martijn Schuemie &amp; Peter Rijnbeek</em></p>
<p>The Common Data Model (CDM) is a relational database model (all data is represented as records in tables that have fields), which means that the data will typically be stored in a relational database using a software platform like PostgreSQL, Oracle, or Microsoft SQL Server. The various OHDSI tools such as ATLAS and the Methods Library work by querying the database behind the scene, but we can also query the database directly ourselves if we have appropriate access rights. The main reason to do this is to perform analyses that currently are not supported by any existing tool. However, directly querying the database also comes with greater risk of making mistakes, as the OHDSI tools are often designed to help guide the user to appropriate analysis of the data. Direct queries do not provide such guidance.</p>
<p>The standard language for querying relational databases is SQL (Structured Query Language), which can be used both to query the database as well as to make changes to the data. Although the basic commands in SQL are indeed standard, meaning the same across software platforms, each platform has its own dialect, with subtle changes. For example, to retrieve the top 10 rows of the PERSON table on SQL Server, one would type:  </p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="SqlAndR.html#cb9-1"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> <span class="op">*</span> <span class="kw">FROM</span> person;</span></code></pre></div>
<p>Whereas the same query on PostgreSQL would be:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="SqlAndR.html#cb10-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> person <span class="kw">LIMIT</span> <span class="dv">10</span>;</span></code></pre></div>
<p>In OHDSI, we would like to be agnostic to the specific dialect a platform uses; we would like to ‘speak’ the same SQL language across all OHDSI databases. For this reason OHDSI developed the <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> package, an R package that can translate from one standard dialect to any of the supported dialects that will be discussed later in this chapter. This standard dialect - <strong>OHDSI SQL</strong> - is mainly a subset of the SQL Server SQL dialect. The example SQL statements provided throughout this chapter will all use OHDSI SQL.    </p>
<p>Each database platform also comes with its own software tools for querying the database using SQL. In OHDSI we developed the <a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a> package, one R package that can connect to many database platforms. DatabaseConnector will also be discussed later in this chapter. </p>
<p>So although one can query a database that conforms to the CDM without using any OHDSI tools, the recommended path is to use the DatabaseConnector and SqlRender packages. This allows queries that are developed at one site to be used at any other site without modification. R itself also immediately provides features to further analyze the data extracted from the database, such as performing statistical analyses and generating (interactive) plots. </p>
<p>In this chapter we assume the reader has a basic understanding of SQL. We first review how to use SqlRender and DatabaseConnector. If the reader does not intend to use these packages these sections can be skipped. In Section <a href="SqlAndR.html#QueryTheCdm">9.3</a> we discuss how to use SQL (in this case OHDSI SQL) to query the CDM. The following section highlights how to use the OHDSI Standardized Vocabulary when querying the CDM. We highlight the QueryLibrary, a collection of commonly-used queries against the CDM that is publicly available. We close this chapter with an example study estimating incidence rates, and implement this study using SqlRender and DatabaseConnector.  </p>
<div id="SqlRender" class="section level2">
<h2><span class="header-section-number">9.1</span> SqlRender</h2>
<p>The <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> package is available on CRAN (the Comprehensive R Archive Network), and can therefore be installed using:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="SqlAndR.html#cb11-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;SqlRender&quot;</span>)</span></code></pre></div>
<p>SqlRender supports a wide array of technical platforms including traditional database systems (PostgreSQL, Microsoft SQL Server, SQLite, and Oracle), parallel data warehouses (Microsoft APS, IBM Netezza, and Amazon Redshift), as well as Big Data platforms (Hadoop through Impala, and Google BigQuery). The R package comes with a package manual and a vignette that explores the full functionality. Here we describer some of the main features.</p>
<div id="sql-parameterization" class="section level3">
<h3><span class="header-section-number">9.1.1</span> SQL Parameterization</h3>
<p>One of the functions of the package is to support parameterization of SQL. Often, small variations of SQL need to be generated based on some parameters. SqlRender offers a simple markup syntax inside the SQL code to allow parameterization. Rendering the SQL based on parameter values is done using the <code>render()</code> function. </p>
<div id="substituting-parameter-values" class="section level4 unnumbered">
<h4>Substituting Parameter Values</h4>
<p>The <code>@</code> character can be used to indicate parameter names that need to be exchanged for actual parameter values when rendering. In the following example, a variable called <code>a</code> is mentioned in the SQL. In the call to the render function the value of this parameter is defined:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="SqlAndR.html#cb12-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM concept WHERE concept_id = @a;&quot;</span></span>
<span id="cb12-2"><a href="SqlAndR.html#cb12-2"></a><span class="kw">render</span>(sql, <span class="dt">a =</span> <span class="dv">123</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id = 123;&quot;</code></pre>
<p>Note that, unlike the parameterization offered by most database management systems, it is just as easy to parameterize table or field names as values:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="SqlAndR.html#cb14-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM @x WHERE person_id = @a;&quot;</span></span>
<span id="cb14-2"><a href="SqlAndR.html#cb14-2"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="st">&quot;observation&quot;</span>, <span class="dt">a =</span> <span class="dv">123</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM observation WHERE person_id = 123;&quot;</code></pre>
<p>The parameter values can be numbers, strings, booleans, as well as vectors, which are converted to comma-delimited lists:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="SqlAndR.html#cb16-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM concept WHERE concept_id IN (@a);&quot;</span></span>
<span id="cb16-2"><a href="SqlAndR.html#cb16-2"></a><span class="kw">render</span>(sql, <span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">234</span>, <span class="dv">345</span>))</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id IN (123,234,345);&quot;</code></pre>
</div>
<div id="if-then-else" class="section level4 unnumbered">
<h4>If-Then-Else</h4>
<p>Sometimes blocks of codes need to be turned on or off based on the values of one or more parameters. This is done using the <code>{Condition} ? {if true} : {if false}</code> syntax. If the <em>condition</em> evaluates to true or 1, the <em>if true</em> block is used, else the <em>if false</em> block is shown (if present).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="SqlAndR.html#cb18-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x} ? {WHERE subject_id = 1}&quot;</span></span>
<span id="cb18-2"><a href="SqlAndR.html#cb18-2"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort &quot;</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="SqlAndR.html#cb20-1"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1&quot;</code></pre>
<p>Simple comparisons are also supported:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="SqlAndR.html#cb22-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x == 1} ? {WHERE subject_id = 1};&quot;</span></span>
<span id="cb22-2"><a href="SqlAndR.html#cb22-2"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="SqlAndR.html#cb24-1"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort ;&quot;</code></pre>
<p>As well as the <code>IN</code> operator:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="SqlAndR.html#cb26-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x IN (1,2,3)} ? {WHERE subject_id = 1};&quot;</span></span>
<span id="cb26-2"><a href="SqlAndR.html#cb26-2"></a><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
</div>
</div>
<div id="translation-to-other-sql-dialects" class="section level3">
<h3><span class="header-section-number">9.1.2</span> Translation to Other SQL Dialects</h3>
<p>Another function of the <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> package is to translate from OHDSI SQL to other SQL dialects. For example:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="SqlAndR.html#cb28-1"></a>sql &lt;-<span class="st"> &quot;SELECT TOP 10 * FROM person;&quot;</span></span>
<span id="cb28-2"><a href="SqlAndR.html#cb28-2"></a><span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> <span class="st">&quot;postgresql&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT  * FROM person LIMIT 10;&quot;</code></pre>
<p>The <code>targetDialect</code> parameter can have the following values: “oracle”, “postgresql”, “pdw”, “redshift”, “impala”, “netezza”, “bigquery”, “sqlite”, and “sql server”. </p>

<div class="rmdimportant">
There are limits to what SQL functions and constructs can be translated properly, both because only a limited set of translation rules have been implemented in the package, but also some SQL features do not have an equivalent in all dialects. This is the primary reason why OHDSI SQL was developed as its own, new SQL dialect. However, whenever possible we have kept to the SQL Server syntax to avoid reinventing the wheel.
</div>

<p>Despite our best efforts, there are quite a few things to consider when writing OHDSI SQL that will run without error on all supported platforms. In what follows we discuss these considerations in detail.</p>
<div id="functions-and-structures-supported-by-translate" class="section level4 unnumbered">
<h4>Functions and Structures Supported By Translate</h4>
<p>These SQL Server functions have been tested and were found to be translated correctly to the various dialects:</p>
<table>
<caption><span id="tab:sqlFunctions">Table 9.1: </span> Functions supported by translate.</caption>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Function</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABS</td>
<td align="left">EXP</td>
<td align="left">RAND</td>
</tr>
<tr class="even">
<td align="left">ACOS</td>
<td align="left">FLOOR</td>
<td align="left">RANK</td>
</tr>
<tr class="odd">
<td align="left">ASIN</td>
<td align="left">GETDATE</td>
<td align="left">RIGHT</td>
</tr>
<tr class="even">
<td align="left">ATAN</td>
<td align="left">HASHBYTES*</td>
<td align="left">ROUND</td>
</tr>
<tr class="odd">
<td align="left">AVG</td>
<td align="left">ISNULL</td>
<td align="left">ROW_NUMBER</td>
</tr>
<tr class="even">
<td align="left">CAST</td>
<td align="left">ISNUMERIC</td>
<td align="left">RTRIM</td>
</tr>
<tr class="odd">
<td align="left">CEILING</td>
<td align="left">LEFT</td>
<td align="left">SIN</td>
</tr>
<tr class="even">
<td align="left">CHARINDEX</td>
<td align="left">LEN</td>
<td align="left">SQRT</td>
</tr>
<tr class="odd">
<td align="left">CONCAT</td>
<td align="left">LOG</td>
<td align="left">SQUARE</td>
</tr>
<tr class="even">
<td align="left">COS</td>
<td align="left">LOG10</td>
<td align="left">STDEV</td>
</tr>
<tr class="odd">
<td align="left">COUNT</td>
<td align="left">LOWER</td>
<td align="left">SUM</td>
</tr>
<tr class="even">
<td align="left">COUNT_BIG</td>
<td align="left">LTRIM</td>
<td align="left">TAN</td>
</tr>
<tr class="odd">
<td align="left">DATEADD</td>
<td align="left">MAX</td>
<td align="left">UPPER</td>
</tr>
<tr class="even">
<td align="left">DATEDIFF</td>
<td align="left">MIN</td>
<td align="left">VAR</td>
</tr>
<tr class="odd">
<td align="left">DATEFROMPARTS</td>
<td align="left">MONTH</td>
<td align="left">YEAR</td>
</tr>
<tr class="even">
<td align="left">DATETIMEFROMPARTS</td>
<td align="left">NEWID</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">DAY</td>
<td align="left">PI</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">EOMONTH</td>
<td align="left">POWER</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>* Requires special privileges on Oracle. Has no equivalent on SQLite.</p>
<p>Similarly, many SQL syntax structures are supported. Here is a non-exhaustive list of expressions that we know will translate well:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="SqlAndR.html#cb30-1"></a><span class="co">-- Simple selects:</span></span>
<span id="cb30-2"><a href="SqlAndR.html#cb30-2"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-3"><a href="SqlAndR.html#cb30-3"></a></span>
<span id="cb30-4"><a href="SqlAndR.html#cb30-4"></a><span class="co">-- Selects with joins:</span></span>
<span id="cb30-5"><a href="SqlAndR.html#cb30-5"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table_1 <span class="kw">INNER</span> <span class="kw">JOIN</span> table_2 <span class="kw">ON</span> a <span class="op">=</span> b;</span>
<span id="cb30-6"><a href="SqlAndR.html#cb30-6"></a></span>
<span id="cb30-7"><a href="SqlAndR.html#cb30-7"></a><span class="co">-- Nested queries:</span></span>
<span id="cb30-8"><a href="SqlAndR.html#cb30-8"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> table_1) tmp <span class="kw">WHERE</span> a <span class="op">=</span> b;</span>
<span id="cb30-9"><a href="SqlAndR.html#cb30-9"></a></span>
<span id="cb30-10"><a href="SqlAndR.html#cb30-10"></a><span class="co">-- Limiting to top rows:</span></span>
<span id="cb30-11"><a href="SqlAndR.html#cb30-11"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-12"><a href="SqlAndR.html#cb30-12"></a></span>
<span id="cb30-13"><a href="SqlAndR.html#cb30-13"></a><span class="co">-- Selecting into a new table:</span></span>
<span id="cb30-14"><a href="SqlAndR.html#cb30-14"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">INTO</span> new_table <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-15"><a href="SqlAndR.html#cb30-15"></a></span>
<span id="cb30-16"><a href="SqlAndR.html#cb30-16"></a><span class="co">-- Creating tables:</span></span>
<span id="cb30-17"><a href="SqlAndR.html#cb30-17"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">table</span> (field <span class="dt">INT</span>);</span>
<span id="cb30-18"><a href="SqlAndR.html#cb30-18"></a></span>
<span id="cb30-19"><a href="SqlAndR.html#cb30-19"></a><span class="co">-- Inserting verbatim values:</span></span>
<span id="cb30-20"><a href="SqlAndR.html#cb30-20"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">VALUES</span> (<span class="dv">1</span>);</span>
<span id="cb30-21"><a href="SqlAndR.html#cb30-21"></a></span>
<span id="cb30-22"><a href="SqlAndR.html#cb30-22"></a><span class="co">-- Inserting from SELECT:</span></span>
<span id="cb30-23"><a href="SqlAndR.html#cb30-23"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">SELECT</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-24"><a href="SqlAndR.html#cb30-24"></a></span>
<span id="cb30-25"><a href="SqlAndR.html#cb30-25"></a><span class="co">-- Simple drop commands:</span></span>
<span id="cb30-26"><a href="SqlAndR.html#cb30-26"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="kw">table</span>;</span>
<span id="cb30-27"><a href="SqlAndR.html#cb30-27"></a></span>
<span id="cb30-28"><a href="SqlAndR.html#cb30-28"></a><span class="co">-- Drop table if it exists:</span></span>
<span id="cb30-29"><a href="SqlAndR.html#cb30-29"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;ACHILLES_analysis&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb30-30"><a href="SqlAndR.html#cb30-30"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> ACHILLES_analysis;</span>
<span id="cb30-31"><a href="SqlAndR.html#cb30-31"></a></span>
<span id="cb30-32"><a href="SqlAndR.html#cb30-32"></a><span class="co">-- Drop temp table if it exists:</span></span>
<span id="cb30-33"><a href="SqlAndR.html#cb30-33"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">&#39;tempdb..#cohorts&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb30-34"><a href="SqlAndR.html#cb30-34"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> #cohorts;</span>
<span id="cb30-35"><a href="SqlAndR.html#cb30-35"></a></span>
<span id="cb30-36"><a href="SqlAndR.html#cb30-36"></a><span class="co">-- Common table expressions:</span></span>
<span id="cb30-37"><a href="SqlAndR.html#cb30-37"></a><span class="kw">WITH</span> cte <span class="kw">AS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">table</span>) <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> cte;</span>
<span id="cb30-38"><a href="SqlAndR.html#cb30-38"></a></span>
<span id="cb30-39"><a href="SqlAndR.html#cb30-39"></a><span class="co">-- OVER clauses:</span></span>
<span id="cb30-40"><a href="SqlAndR.html#cb30-40"></a><span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> a <span class="kw">ORDER</span> <span class="kw">BY</span> b)</span>
<span id="cb30-41"><a href="SqlAndR.html#cb30-41"></a>  <span class="kw">AS</span> <span class="ot">&quot;Row Number&quot;</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-42"><a href="SqlAndR.html#cb30-42"></a></span>
<span id="cb30-43"><a href="SqlAndR.html#cb30-43"></a><span class="co">-- CASE WHEN clauses:</span></span>
<span id="cb30-44"><a href="SqlAndR.html#cb30-44"></a><span class="kw">SELECT</span> <span class="cf">CASE</span> <span class="cf">WHEN</span> a<span class="op">=</span><span class="dv">1</span> <span class="cf">THEN</span> a <span class="cf">ELSE</span> <span class="dv">0</span> <span class="cf">END</span> <span class="kw">AS</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;</span>
<span id="cb30-45"><a href="SqlAndR.html#cb30-45"></a></span>
<span id="cb30-46"><a href="SqlAndR.html#cb30-46"></a><span class="co">-- UNIONs:</span></span>
<span id="cb30-47"><a href="SqlAndR.html#cb30-47"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">UNION</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span>
<span id="cb30-48"><a href="SqlAndR.html#cb30-48"></a></span>
<span id="cb30-49"><a href="SqlAndR.html#cb30-49"></a><span class="co">-- INTERSECTIONs:</span></span>
<span id="cb30-50"><a href="SqlAndR.html#cb30-50"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">INTERSECT</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span>
<span id="cb30-51"><a href="SqlAndR.html#cb30-51"></a></span>
<span id="cb30-52"><a href="SqlAndR.html#cb30-52"></a><span class="co">-- EXCEPT:</span></span>
<span id="cb30-53"><a href="SqlAndR.html#cb30-53"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> a <span class="kw">EXCEPT</span> <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> b;</span></code></pre></div>
</div>
<div id="string-concatenation" class="section level4 unnumbered">
<h4>String Concatenation</h4>
<p>String concatenation is one area where SQL Server is less specific than other dialects. In SQL Server, one would write <code>SELECT first_name + ' ' + last_name AS full_name FROM table</code>, but this should be <code>SELECT first_name || ' ' || last_name AS full_name FROM table</code> in PostgreSQL and Oracle. SqlRender tries to guess when values that are being concatenated are strings. In the example above, because we have an explicit string (the space surrounded by single quotation marks), the translation will be correct. However, if the query had been <code>SELECT first_name + last_name AS full_name FROM table</code>, SqlRender would have had no clue the two fields were strings, and would incorrectly leave the plus sign. Another clue that a value is a string is an explicit cast to VARCHAR, so <code>SELECT last_name + CAST(age AS VARCHAR(3)) AS full_name FROM table</code> would also be translated correctly. To avoid ambiguity altogether, it is probable best to use the <code>CONCAT()</code> function to concatenate two or more strings.</p>
</div>
<div id="table-aliases-and-the-as-keyword" class="section level4 unnumbered">
<h4>Table Aliases and the AS Keyword</h4>
<p>Many SQL dialects allow the use of the <code>AS</code> keyword when defining a table alias, but will also work fine without the keyword. For example, both these SQL statements are fine for SQL Server, PostgreSQL, Redshift, etc.:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="SqlAndR.html#cb31-1"></a><span class="co">-- Using AS keyword</span></span>
<span id="cb31-2"><a href="SqlAndR.html#cb31-2"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb31-3"><a href="SqlAndR.html#cb31-3"></a><span class="kw">FROM</span> my_table <span class="kw">AS</span> table_1</span>
<span id="cb31-4"><a href="SqlAndR.html#cb31-4"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb31-5"><a href="SqlAndR.html#cb31-5"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> other_table</span>
<span id="cb31-6"><a href="SqlAndR.html#cb31-6"></a>) <span class="kw">AS</span> table_2</span>
<span id="cb31-7"><a href="SqlAndR.html#cb31-7"></a><span class="kw">ON</span> table_1.person_id <span class="op">=</span> table_2.person_id;</span>
<span id="cb31-8"><a href="SqlAndR.html#cb31-8"></a></span>
<span id="cb31-9"><a href="SqlAndR.html#cb31-9"></a><span class="co">-- Not using AS keyword</span></span>
<span id="cb31-10"><a href="SqlAndR.html#cb31-10"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb31-11"><a href="SqlAndR.html#cb31-11"></a><span class="kw">FROM</span> my_table table_1</span>
<span id="cb31-12"><a href="SqlAndR.html#cb31-12"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> (</span>
<span id="cb31-13"><a href="SqlAndR.html#cb31-13"></a>  <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> other_table</span>
<span id="cb31-14"><a href="SqlAndR.html#cb31-14"></a>) table_2</span>
<span id="cb31-15"><a href="SqlAndR.html#cb31-15"></a><span class="kw">ON</span> table_1.person_id <span class="op">=</span> table_2.person_id;</span></code></pre></div>
<p>However, Oracle will throw an error when the <code>AS</code> keyword is used. In the above example, the first query will fail. It is therefore recommended to not use the <code>AS</code> keyword when aliasing tables. (Note: we can’t make SqlRender handle this, because it can’t easily distinguish between table aliases where Oracle doesn’t allow <code>AS</code> to be used, and field aliases, where Oracle requires <code>AS</code> to be used.)</p>
</div>
<div id="temp-tables" class="section level4 unnumbered">
<h4>Temp Tables</h4>
<p>Temp tables can be very useful to store intermediate results, and when used correctly can dramatically improve performance of queries. On most database platforms temp tables have very nice properties: they’re only visible to the current user, are automatically dropped when the session ends, and can be created even when the user has no write access. Unfortunately, in Oracle temp tables are basically permanent tables, with the only difference that the data inside the table is only visible to the current user. This is why, in Oracle, SqlRender will try to emulate temp tables by</p>
<ol style="list-style-type: decimal">
<li>Adding a random string to the table name so tables from different users will not conflict.</li>
<li>Allowing the user to specify the schema where the temp tables will be created.</li>
</ol>
<p>For example:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="SqlAndR.html#cb32-1"></a>sql &lt;-<span class="st"> &quot;SELECT * FROM #children;&quot;</span></span>
<span id="cb32-2"><a href="SqlAndR.html#cb32-2"></a><span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> <span class="st">&quot;oracle&quot;</span>, <span class="dt">oracleTempSchema =</span> <span class="st">&quot;temp_schema&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM temp_schema.wyp4iskgchildren ;&quot;</code></pre>
<p>Note that the user will need to have write privileges on <code>temp_schema</code>.</p>
<p>Also note that because Oracle has a limit on table names of 30 characters. <strong>Temp table names are only allowed to be at most 22 characters long</strong>, because else the name will become too long after appending the session ID.</p>
<p>Furthermore, remember that temp tables are not automatically dropped on Oracle, so you will need to explicitly <code>TRUNCATE</code> and <code>DROP</code> all temp tables once you’re done with them to prevent orphan tables accumulating in the Oracle temp schema.</p>
</div>
<div id="implicit-casts" class="section level4 unnumbered">
<h4>Implicit Casts</h4>
<p>One of the few points where SQL Server is less explicit than other dialects is that it allows implicit casts. For example, this code will work on SQL Server:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="SqlAndR.html#cb34-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> #temp (txt <span class="dt">VARCHAR</span>);</span>
<span id="cb34-2"><a href="SqlAndR.html#cb34-2"></a></span>
<span id="cb34-3"><a href="SqlAndR.html#cb34-3"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #temp</span>
<span id="cb34-4"><a href="SqlAndR.html#cb34-4"></a><span class="kw">SELECT</span> <span class="st">&#39;1&#39;</span>;</span>
<span id="cb34-5"><a href="SqlAndR.html#cb34-5"></a></span>
<span id="cb34-6"><a href="SqlAndR.html#cb34-6"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
<p>Even though <code>txt</code> is a VARCHAR field and we are comparing it with an integer, SQL Server will automatically cast one of the two to the correct type to allow the comparison. In contrast, other dialects such as PostgreSQL will throw an error when trying to compare a VARCHAR with an INT.</p>
<p>You should therefore always make casts explicit. In the above example, the last statement should be replaced with either</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="SqlAndR.html#cb35-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt <span class="op">=</span> <span class="fu">CAST</span>(<span class="dv">1</span> <span class="kw">AS</span> <span class="dt">VARCHAR</span>);</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="SqlAndR.html#cb36-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> <span class="fu">CAST</span>(txt <span class="kw">AS</span> <span class="dt">INT</span>) <span class="op">=</span> <span class="dv">1</span>;</span></code></pre></div>
</div>
<div id="case-sensitivity-in-string-comparisons" class="section level4 unnumbered">
<h4>Case Sensitivity in String Comparisons</h4>
<p>Some DBMS platforms such as SQL Server always perform string comparisons in a case-insensitive way, while others such as PostgreSQL are always case sensitive. It is therefore recommended to always assume case-sensitive comparisons, and to explicitly make comparisons case-insensitive when unsure about the case. For example, instead of</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="SqlAndR.html#cb37-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> concept <span class="kw">WHERE</span> concept_class_id <span class="op">=</span> <span class="st">&#39;Clinical Finding&#39;</span></span></code></pre></div>
<p>it is preferred to use</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="SqlAndR.html#cb38-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> concept <span class="kw">WHERE</span> <span class="fu">LOWER</span>(concept_class_id) <span class="op">=</span> <span class="st">&#39;clinical finding&#39;</span></span></code></pre></div>
</div>
<div id="schemas-and-databases" class="section level4 unnumbered">
<h4>Schemas and Databases</h4>
<p>In SQL Server, tables are located in a schema, and schemas reside in a database. For example, <code>cdm_data.dbo.person</code> refers to the <code>person</code> table in the <code>dbo</code> schema in the <code>cdm_data</code> database. In other dialects, even though a similar hierarchy often exists they are used very differently. In SQL Server, there is typically one schema per database (often called <code>dbo</code>), and users can easily use data in different databases. On other platforms, for example in PostgreSQL, it is not possible to use data across databases in a single session, but there are often many schemas in a database. In PostgreSQL one could say that the equivalent of SQL Server’s database is the schema.</p>
<p>We therefore recommend concatenating SQL Server’s database and schema into a single parameter, which we typically call <code>@databaseSchema</code>. For example, we could have the parameterized SQL</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="SqlAndR.html#cb39-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> @databaseSchema.person</span></code></pre></div>
<p>where on SQL Server we can include both database and schema names in the value: <code>databaseSchema = "cdm_data.dbo"</code>. On other platforms, we can use the same code, but now only specify the schema as the parameter value: <code>databaseSchema = "cdm_data"</code>.</p>
<p>The one situation where this will fail is the <code>USE</code> command, since <code>USE cdm_data.dbo;</code> will throw an error. It is therefore preferred not to use the <code>USE</code> command, but always specify the database / schema where a table is located.</p>
</div>
<div id="debugging-parameterized-sql" class="section level4 unnumbered">
<h4>Debugging Parameterized SQL</h4>
<p>Debugging parameterized SQL can be a bit complicated. Only the rendered SQL can be tested against a database server, but changes to the code should be made in the parameterized (pre-rendered) SQL. </p>
<p>A Shiny app is included in the SqlRender package for interactively editing source SQL and generating rendered and translated SQL. The app can be started using:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="SqlAndR.html#cb40-1"></a><span class="kw">launchSqlRenderDeveloper</span>()</span></code></pre></div>
<p>That will open the default browser with the app shown in Figure <a href="SqlAndR.html#fig:sqlDeveloper">9.1</a>. The app is also publicly available on the web.<a href="#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a></p>
<div class="figure" style="text-align: center"><span id="fig:sqlDeveloper"></span>
<img src="images/SqlAndR/sqlDeveloper.png" alt="The SqlDeveloper Shiny app." width="100%" />
<p class="caption">
Figure 9.1: The SqlDeveloper Shiny app.
</p>
</div>
<p>In the app you can enter OHDSI SQL, select the target dialect as well as provide values for the parameters that appear in your SQL, and the translation will automatically appear at the bottom.</p>
</div>
</div>
</div>
<div id="DatabaseConnector" class="section level2">
<h2><span class="header-section-number">9.2</span> DatabaseConnector</h2>
<p><a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a> is an R package for connecting to various database platforms using Java’s JDBC drivers. The DatabaseConnector package is available on CRAN (the Comprehensive R Archive Network), and can therefore be installed using:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="SqlAndR.html#cb41-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;DatabaseConnector&quot;</span>)</span></code></pre></div>
<p>DatabaseConnector supports a wide array of technical platforms including traditional database systems (PostgreSQL, Microsoft SQL Server, SQLite, and Oracle), parallel data warehouses (Microsoft APS, IBM Netezza, and Amazon ), as well as Big Data platforms (Hadoop through Impala, and Google BigQuery). The package already contains most drivers, but because of licensing reasons the drivers for BigQuery, Netezza and Impala are not included but must be obtained by the user. Type <code>?jdbcDrivers</code> for instructions on how to download these drivers. Once downloaded, you can use the <code>pathToDriver</code> argument of the <code>connect</code>, <code>dbConnect</code>, and <code>createConnectionDetails</code> functions.</p>
<div id="creating-a-connection" class="section level3">
<h3><span class="header-section-number">9.2.1</span> Creating a Connection</h3>
<p>To connect to a database a number of details need to be specified, such as the database platform, the location of the server, the user name, and password. We can call the <code>connect</code> function and specify these details directly: </p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="SqlAndR.html#cb42-1"></a>conn &lt;-<span class="st"> </span><span class="kw">connect</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb42-2"><a href="SqlAndR.html#cb42-2"></a>                <span class="dt">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb42-3"><a href="SqlAndR.html#cb42-3"></a>                <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb42-4"><a href="SqlAndR.html#cb42-4"></a>                <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb42-5"><a href="SqlAndR.html#cb42-5"></a>                <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>See <code>?connect</code> for information on which details are required for each platform. Don’t forget to close any connection afterwards:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="SqlAndR.html#cb44-1"></a><span class="kw">disconnect</span>(conn)</span></code></pre></div>
<p>Note that, instead of providing the server name, it is also possible to provide the JDBC connection string if this is more convenient:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="SqlAndR.html#cb45-1"></a>connString &lt;-<span class="st"> &quot;jdbc:postgresql://localhost:5432/postgres&quot;</span></span>
<span id="cb45-2"><a href="SqlAndR.html#cb45-2"></a>conn &lt;-<span class="st"> </span><span class="kw">connect</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb45-3"><a href="SqlAndR.html#cb45-3"></a>                <span class="dt">connectionString =</span> connString,</span>
<span id="cb45-4"><a href="SqlAndR.html#cb45-4"></a>                <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb45-5"><a href="SqlAndR.html#cb45-5"></a>                <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb45-6"><a href="SqlAndR.html#cb45-6"></a>                <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>Sometimes we may want to first specify the connection details, and defer connecting until later. This may be convenient for example when the connection is established inside a function, and the details need to be passed as an argument. We can use the <code>createConnectionDetails</code> function for this purpose:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="SqlAndR.html#cb47-1"></a>details &lt;-<span class="st"> </span><span class="kw">createConnectionDetails</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb47-2"><a href="SqlAndR.html#cb47-2"></a>                                   <span class="dt">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb47-3"><a href="SqlAndR.html#cb47-3"></a>                                   <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb47-4"><a href="SqlAndR.html#cb47-4"></a>                                   <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,</span>
<span id="cb47-5"><a href="SqlAndR.html#cb47-5"></a>                                   <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)</span>
<span id="cb47-6"><a href="SqlAndR.html#cb47-6"></a>conn &lt;-<span class="st"> </span><span class="kw">connect</span>(details)</span></code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
</div>
<div id="querying" class="section level3">
<h3><span class="header-section-number">9.2.2</span> Querying</h3>
<p>The main functions for querying database are the <code>querySql</code> and <code>executeSql</code> functions. The difference between these functions is that <code>querySql</code> expects data to be returned by the database, and can handle only one SQL statement at a time. In contrast, <code>executeSql</code> does not expect data to be returned, and accepts multiple SQL statements in a single SQL string. </p>
<p>Some examples:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="SqlAndR.html#cb49-1"></a><span class="kw">querySql</span>(conn, <span class="st">&quot;SELECT TOP 3 * FROM person&quot;</span>)</span></code></pre></div>
<pre><code>##   person_id gender_concept_id year_of_birth
## 1         1              8507          1975
## 2         2              8507          1976
## 3         3              8507          1977</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="SqlAndR.html#cb51-1"></a><span class="kw">executeSql</span>(conn, <span class="st">&quot;TRUNCATE TABLE foo; DROP TABLE foo;&quot;</span>)</span></code></pre></div>
<p>Both functions provide extensive error reporting: When an error is thrown by the server, the error message and the offending piece of SQL are written to a text file to allow better debugging. The <code>executeSql</code> function also by default shows a progress bar, indicating the percentage of SQL statements that has been executed. If those attributes are not desired, the package also offers the <code>lowLevelQuerySql</code> and <code>lowLevelExecuteSql</code> functions.</p>
</div>
<div id="querying-using-ffdf-objects" class="section level3">
<h3><span class="header-section-number">9.2.3</span> Querying Using Ffdf Objects</h3>
<p>Sometimes the data to be fetched from the database is too large to fit into memory. As mentioned in Section <a href="OhdsiAnalyticsTools.html#BigDataSupport">8.4.2</a>, in such a case we can use the <code>ff</code> package to store R data objects on file, and use them as if they are available in memory. <code>DatabaseConnector</code> can download data directly into ffdf objects:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="SqlAndR.html#cb52-1"></a>x &lt;-<span class="st"> </span><span class="kw">querySql.ffdf</span>(conn, <span class="st">&quot;SELECT * FROM person&quot;</span>)</span></code></pre></div>
<p>x is now an ffdf object.</p>
</div>
<div id="querying-different-platforms-using-the-same-sql" class="section level3">
<h3><span class="header-section-number">9.2.4</span> Querying Different Platforms Using the Same SQL</h3>
<p>The following convenience functions are available that first call the <code>render</code> and <code>translate</code> functions in the SqlRender package: <code>renderTranslateExecuteSql</code>, <code>renderTranslateQuerySql</code>, <code>renderTranslateQuerySql.ffdf</code>. For example:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="SqlAndR.html#cb53-1"></a>x &lt;-<span class="st"> </span><span class="kw">renderTranslateQuerySql</span>(conn,</span>
<span id="cb53-2"><a href="SqlAndR.html#cb53-2"></a>                             <span class="dt">sql =</span> <span class="st">&quot;SELECT TOP 10 * FROM @schema.person&quot;</span>,</span>
<span id="cb53-3"><a href="SqlAndR.html#cb53-3"></a>                             <span class="dt">schema =</span> <span class="st">&quot;cdm_synpuf&quot;</span>)</span></code></pre></div>
<p>Note that the SQL Server-specific ‘TOP 10’ syntax will be translated to for example ‘LIMIT 10’ on PostgreSQL, and that the SQL parameter <code>@schema</code> will be instantiated with the provided value ‘cdm_synpuf’.</p>
</div>
<div id="inserting-tables" class="section level3">
<h3><span class="header-section-number">9.2.5</span> Inserting Tables</h3>
<p>Although it is also possible to insert data in the database by sending SQL statements using the <code>executeSql</code> function, it is often more convenient and faster (due to some optimization) to use the <code>insertTable</code> function:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="SqlAndR.html#cb54-1"></a><span class="kw">data</span>(mtcars)</span>
<span id="cb54-2"><a href="SqlAndR.html#cb54-2"></a><span class="kw">insertTable</span>(conn, <span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">createTable =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>In this example, we’re uploading the mtcars data frame to a table called ‘mtcars’ on the server, which will be automatically created.</p>
</div>
</div>
<div id="QueryTheCdm" class="section level2">
<h2><span class="header-section-number">9.3</span> Querying the CDM</h2>
<p>In the following examples we use OHDSI SQL to query a database that adheres to the CDM. These queries use <code>@cdm</code> to denote the database schema where the data in CDM can be found.</p>
<p>We can start by just querying how many people are in the database:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb55-1"><a href="SqlAndR.html#cb55-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> person_count <span class="kw">FROM</span> @cdm.person;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">PERSON_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26299001</td>
</tr>
</tbody>
</table>
<p>Or perhaps we’re interested in the average length of an observation period:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb56-1"><a href="SqlAndR.html#cb56-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(DATEDIFF(<span class="dt">DAY</span>,</span>
<span id="cb56-2"><a href="SqlAndR.html#cb56-2"></a>                    observation_period_start_date,</span>
<span id="cb56-3"><a href="SqlAndR.html#cb56-3"></a>                    observation_period_end_date) <span class="op">/</span> <span class="fl">365.25</span>) <span class="kw">AS</span> num_years</span>
<span id="cb56-4"><a href="SqlAndR.html#cb56-4"></a><span class="kw">FROM</span> @cdm.observation_period;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">NUM_YEARS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1.980803</td>
</tr>
</tbody>
</table>
<p>We can join tables to produce additional statistics. A join combines fields from multiple tables, typically by requiring specific fields in the tables to have the same value. For example, here we join the PERSON table to the OBSERVATION_PERIOD table on the PERSON_ID fields in both tables. In other words, the result of the join is a new table-like set that has all the fields of the two tables, but in all rows the PERSON_ID fields from the two tables must have the same value. We can now for example compute the maximum age at observation end by using the OBSERVATION_PERIOD_END_DATE field from the OBSERVATION_PERIOD table together with the year_of_birth field of the PERSON table:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb57-1"><a href="SqlAndR.html#cb57-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="dt">YEAR</span>(observation_period_end_date) <span class="op">-</span></span>
<span id="cb57-2"><a href="SqlAndR.html#cb57-2"></a>           year_of_birth) <span class="kw">AS</span> max_age</span>
<span id="cb57-3"><a href="SqlAndR.html#cb57-3"></a><span class="kw">FROM</span> @cdm.person</span>
<span id="cb57-4"><a href="SqlAndR.html#cb57-4"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.observation_period</span>
<span id="cb57-5"><a href="SqlAndR.html#cb57-5"></a>  <span class="kw">ON</span> person.person_id <span class="op">=</span> observation_period.person_id;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">MAX_AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">90</td>
</tr>
</tbody>
</table>
<p>A much more complicated query is needed to determine the distribution of age at the start of observation. In this query, we first join the PERSON to the OBSERVATION_PERIOD table to compute age at start of observation. We also compute the ordering for this joined set based on age, and store it as order_nr. Because we want to use the result of this join multiple times, we define it as a common table expression (CTE) (defined using <code>WITH ... AS</code>) that we call “ages,” meaning we can refer to ages as if it is an existing table. We count the number of rows in ages to produce “n,” and then for each quantile find the minimum age where the order_nr is smaller than the fraction times n. For example, to find the median we use the minimum age where <span class="math inline">\(order\_nr &lt; .50 * n\)</span>. The minimum and maximum age are computed separately:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb58-1"><a href="SqlAndR.html#cb58-1"></a><span class="kw">WITH</span> ages</span>
<span id="cb58-2"><a href="SqlAndR.html#cb58-2"></a><span class="kw">AS</span> (</span>
<span id="cb58-3"><a href="SqlAndR.html#cb58-3"></a>    <span class="kw">SELECT</span> age,</span>
<span id="cb58-4"><a href="SqlAndR.html#cb58-4"></a>        <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (</span>
<span id="cb58-5"><a href="SqlAndR.html#cb58-5"></a>            <span class="kw">ORDER</span> <span class="kw">BY</span> age</span>
<span id="cb58-6"><a href="SqlAndR.html#cb58-6"></a>            ) order_nr</span>
<span id="cb58-7"><a href="SqlAndR.html#cb58-7"></a>    <span class="kw">FROM</span> (</span>
<span id="cb58-8"><a href="SqlAndR.html#cb58-8"></a>        <span class="kw">SELECT</span> <span class="dt">YEAR</span>(observation_period_start_date) <span class="op">-</span> year_of_birth <span class="kw">AS</span> age</span>
<span id="cb58-9"><a href="SqlAndR.html#cb58-9"></a>        <span class="kw">FROM</span> @cdm.person</span>
<span id="cb58-10"><a href="SqlAndR.html#cb58-10"></a>        <span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.observation_period</span>
<span id="cb58-11"><a href="SqlAndR.html#cb58-11"></a>            <span class="kw">ON</span> person.person_id <span class="op">=</span> observation_period.person_id</span>
<span id="cb58-12"><a href="SqlAndR.html#cb58-12"></a>        ) age_computed</span>
<span id="cb58-13"><a href="SqlAndR.html#cb58-13"></a>    )</span>
<span id="cb58-14"><a href="SqlAndR.html#cb58-14"></a><span class="kw">SELECT</span> <span class="fu">MIN</span>(age) <span class="kw">AS</span> min_age,</span>
<span id="cb58-15"><a href="SqlAndR.html#cb58-15"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-16"><a href="SqlAndR.html#cb58-16"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> <span class="fl">.25</span> <span class="op">*</span> n</span>
<span id="cb58-17"><a href="SqlAndR.html#cb58-17"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-18"><a href="SqlAndR.html#cb58-18"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-19"><a href="SqlAndR.html#cb58-19"></a>            <span class="cf">END</span>) <span class="kw">AS</span> q25_age,</span>
<span id="cb58-20"><a href="SqlAndR.html#cb58-20"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-21"><a href="SqlAndR.html#cb58-21"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> <span class="fl">.50</span> <span class="op">*</span> n</span>
<span id="cb58-22"><a href="SqlAndR.html#cb58-22"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-23"><a href="SqlAndR.html#cb58-23"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-24"><a href="SqlAndR.html#cb58-24"></a>            <span class="cf">END</span>) <span class="kw">AS</span> median_age,</span>
<span id="cb58-25"><a href="SqlAndR.html#cb58-25"></a>    <span class="fu">MIN</span>(<span class="cf">CASE</span></span>
<span id="cb58-26"><a href="SqlAndR.html#cb58-26"></a>            <span class="cf">WHEN</span> order_nr <span class="op">&lt;</span> <span class="fl">.75</span> <span class="op">*</span> n</span>
<span id="cb58-27"><a href="SqlAndR.html#cb58-27"></a>                <span class="cf">THEN</span> <span class="dv">9999</span></span>
<span id="cb58-28"><a href="SqlAndR.html#cb58-28"></a>            <span class="cf">ELSE</span> age</span>
<span id="cb58-29"><a href="SqlAndR.html#cb58-29"></a>            <span class="cf">END</span>) <span class="kw">AS</span> q75_age,</span>
<span id="cb58-30"><a href="SqlAndR.html#cb58-30"></a>    <span class="fu">MAX</span>(age) <span class="kw">AS</span> max_age</span>
<span id="cb58-31"><a href="SqlAndR.html#cb58-31"></a><span class="kw">FROM</span> ages</span>
<span id="cb58-32"><a href="SqlAndR.html#cb58-32"></a><span class="kw">CROSS</span> <span class="kw">JOIN</span> (</span>
<span id="cb58-33"><a href="SqlAndR.html#cb58-33"></a>    <span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> n</span>
<span id="cb58-34"><a href="SqlAndR.html#cb58-34"></a>    <span class="kw">FROM</span> ages</span>
<span id="cb58-35"><a href="SqlAndR.html#cb58-35"></a>    ) population_size;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">MIN_AGE</th>
<th align="right">Q25_AGE</th>
<th align="right">MEDIAN_AGE</th>
<th align="right">Q75_AGE</th>
<th align="right">MAX_AGE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">6</td>
<td align="right">17</td>
<td align="right">34</td>
<td align="right">90</td>
</tr>
</tbody>
</table>
<p>More complex computations can also be performed in R instead of using SQL. For example, we can get the same answer using this R code:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="SqlAndR.html#cb59-1"></a>sql &lt;-<span class="st"> &quot;SELECT YEAR(observation_period_start_date) -</span></span>
<span id="cb59-2"><a href="SqlAndR.html#cb59-2"></a><span class="st">               year_of_birth AS age</span></span>
<span id="cb59-3"><a href="SqlAndR.html#cb59-3"></a><span class="st">FROM @cdm.person</span></span>
<span id="cb59-4"><a href="SqlAndR.html#cb59-4"></a><span class="st">INNER JOIN @cdm.observation_period</span></span>
<span id="cb59-5"><a href="SqlAndR.html#cb59-5"></a><span class="st">  ON person.person_id = observation_period.person_id;&quot;</span></span>
<span id="cb59-6"><a href="SqlAndR.html#cb59-6"></a>age &lt;-<span class="st"> </span><span class="kw">renderTranslateQuerySql</span>(conn, sql, <span class="dt">cdm =</span> <span class="st">&quot;cdm&quot;</span>)</span>
<span id="cb59-7"><a href="SqlAndR.html#cb59-7"></a><span class="kw">quantile</span>(age[, <span class="dv">1</span>], <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##   0%  25%  50%  75% 100%
##    0    6   17   34   90</code></pre>
<p>Here we compute age on the server, download all ages, and then compute the age distribution. However, this requires millions of rows of data to be downloaded from the database server, and is therefore not very efficient. You will need to decide on a case-by-case basis whether a computation is best performed in SQL or in R.</p>
<p>Queries can use the source values in the CDM. For example, we can retrieve the top 10 most frequent condition source codes using:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb61-1"><a href="SqlAndR.html#cb61-1"></a><span class="kw">SELECT</span> TOP <span class="dv">10</span> condition_source_value,</span>
<span id="cb61-2"><a href="SqlAndR.html#cb61-2"></a>  <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> code_count</span>
<span id="cb61-3"><a href="SqlAndR.html#cb61-3"></a><span class="kw">FROM</span> @cdm.condition_occurrence</span>
<span id="cb61-4"><a href="SqlAndR.html#cb61-4"></a><span class="kw">GROUP</span> <span class="kw">BY</span> condition_source_value</span>
<span id="cb61-5"><a href="SqlAndR.html#cb61-5"></a><span class="kw">ORDER</span> <span class="kw">BY</span> <span class="op">-</span><span class="fu">COUNT</span>(<span class="op">*</span>);</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">CONDITION_SOURCE_VALUE</th>
<th align="right">CODE_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">4019</td>
<td align="right">49094668</td>
</tr>
<tr class="even">
<td align="right">25000</td>
<td align="right">36149139</td>
</tr>
<tr class="odd">
<td align="right">78099</td>
<td align="right">28908399</td>
</tr>
<tr class="even">
<td align="right">319</td>
<td align="right">25798284</td>
</tr>
<tr class="odd">
<td align="right">31401</td>
<td align="right">22547122</td>
</tr>
<tr class="even">
<td align="right">317</td>
<td align="right">22453999</td>
</tr>
<tr class="odd">
<td align="right">311</td>
<td align="right">19626574</td>
</tr>
<tr class="even">
<td align="right">496</td>
<td align="right">19570098</td>
</tr>
<tr class="odd">
<td align="right">I10</td>
<td align="right">19453451</td>
</tr>
<tr class="even">
<td align="right">3180</td>
<td align="right">18973883</td>
</tr>
</tbody>
</table>
<p>Here we grouped records in the CONDITION_OCCURRENCE table by values of the CONDITION_SOURCE_VALUE field, and counted the number of records in each group. We retrieve the CONDITION_SOURCE_VALUE and the count, and reverse-order it by the count.</p>
</div>
<div id="using-the-vocabulary-when-querying" class="section level2">
<h2><span class="header-section-number">9.4</span> Using the Vocabulary When Querying</h2>
<p>Many operations require the vocabulary to be useful. The Vocabulary tables are part of the CDM, and are therefore available using SQL queries. Here we show how queries against the Vocabulary can be combined with queries against the CDM. Many fields in the CDM contain concept IDs which can be resolved using the CONCEPT table. For example, we may wish to count the number of persons in the database stratified by gender, and it would be convenient to resolve the GENDER_CONCEPT_ID field to a concept name:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb62-1"><a href="SqlAndR.html#cb62-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> subject_count,</span>
<span id="cb62-2"><a href="SqlAndR.html#cb62-2"></a>  concept_name</span>
<span id="cb62-3"><a href="SqlAndR.html#cb62-3"></a><span class="kw">FROM</span> @cdm.person</span>
<span id="cb62-4"><a href="SqlAndR.html#cb62-4"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept</span>
<span id="cb62-5"><a href="SqlAndR.html#cb62-5"></a>  <span class="kw">ON</span> person.gender_concept_id <span class="op">=</span> concept.concept_id</span>
<span id="cb62-6"><a href="SqlAndR.html#cb62-6"></a><span class="kw">GROUP</span> <span class="kw">BY</span> concept_name;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">SUBJECT_COUNT</th>
<th align="right">CONCEPT_NAME</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">14927548</td>
<td align="right">FEMALE</td>
</tr>
<tr class="even">
<td align="right">11371453</td>
<td align="right">MALE</td>
</tr>
</tbody>
</table>
<p>A very powerful feature of the Vocabulary is its hierarchy. A very common query looks for a specific concept <em>and all of its descendants</em>. For example, imagine we wish to count the number of prescriptions containing the ingredient ibuprofen:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb63-1"><a href="SqlAndR.html#cb63-1"></a><span class="kw">SELECT</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> prescription_count</span>
<span id="cb63-2"><a href="SqlAndR.html#cb63-2"></a><span class="kw">FROM</span> @cdm.drug_exposure</span>
<span id="cb63-3"><a href="SqlAndR.html#cb63-3"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept_ancestor</span>
<span id="cb63-4"><a href="SqlAndR.html#cb63-4"></a>  <span class="kw">ON</span> drug_concept_id <span class="op">=</span> descendant_concept_id</span>
<span id="cb63-5"><a href="SqlAndR.html#cb63-5"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdm.concept ingredient</span>
<span id="cb63-6"><a href="SqlAndR.html#cb63-6"></a>  <span class="kw">ON</span> ancestor_concept_id <span class="op">=</span> ingredient.concept_id</span>
<span id="cb63-7"><a href="SqlAndR.html#cb63-7"></a><span class="kw">WHERE</span> <span class="fu">LOWER</span>(ingredient.concept_name) <span class="op">=</span> <span class="st">&#39;ibuprofen&#39;</span></span>
<span id="cb63-8"><a href="SqlAndR.html#cb63-8"></a>  <span class="kw">AND</span> ingredient.concept_class_id <span class="op">=</span> <span class="st">&#39;Ingredient&#39;</span></span>
<span id="cb63-9"><a href="SqlAndR.html#cb63-9"></a>  <span class="kw">AND</span> ingredient.standard_concept <span class="op">=</span> <span class="st">&#39;S&#39;</span>;</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">PRESCRIPTION_COUNT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">26871214</td>
</tr>
</tbody>
</table>
</div>
<div id="querylibrary" class="section level2">
<h2><span class="header-section-number">9.5</span> QueryLibrary</h2>
<p></p>
<p>QueryLibrary is a library of commonly-used SQL queries for the CDM. It is available as an online application<a href="#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a> shown in Figure <a href="SqlAndR.html#fig:queryLibrary">9.2</a>, and as an R package.<a href="#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a></p>
<div class="figure" style="text-align: center"><span id="fig:queryLibrary"></span>
<img src="images/SqlAndR/queryLibrary.png" alt="QueryLibrary: a library of SQL queries against the CDM." width="100%" />
<p class="caption">
Figure 9.2: QueryLibrary: a library of SQL queries against the CDM.
</p>
</div>
<p>The purpose of the library is to help new users learn how to query the CDM. The queries in the library have been reviewed and approved by the OHDSI community. The query library is primarily intended for training purposes, but it is also a valuable resource for experienced users.</p>
<p>The QueryLibrary makes use of SqlRender to output the queries in the SQL dialect of choice. Users can also specify the CDM database schema, vocabulary database schema (if separate), and the Oracle temp schema (if needed), so the queries will be automatically rendered with these settings.</p>
</div>
<div id="designing-a-simple-study" class="section level2">
<h2><span class="header-section-number">9.6</span> Designing a Simple Study</h2>
<div id="problem-definition" class="section level3">
<h3><span class="header-section-number">9.6.1</span> Problem Definition</h3>
<p>Angioedema is a well-known side-effect of ACE inhibitors (ACEi). <span class="citation">Slater et al. (<a href="#ref-slater_1988" role="doc-biblioref">1988</a>)</span> estimate the incidence rate of angioedema in the first week of ACEi treatment to be one case per 3,000 patients per week. Here we seek to replicate this finding, and stratify by age and gender. For simplicity, we focus on one ACEi: lisinopril. We thus answer the question</p>
<blockquote>
<p>What is the rate of angioedema in the first week following lisinopril treatment initiation, stratified by age and gender?</p>
</blockquote>
</div>
<div id="exposure" class="section level3">
<h3><span class="header-section-number">9.6.2</span> Exposure</h3>
<p>We’ll define exposure as first exposure to lisinopril. By first we mean no earlier exposure to lisinopril. We require 365 days of continuous observation time prior to the first exposure.</p>
</div>
<div id="outcome" class="section level3">
<h3><span class="header-section-number">9.6.3</span> Outcome</h3>
<p>We define angioedema as any occurrence of an angioedema diagnosis code during an inpatient or emergency room (ER) visit.</p>
</div>
<div id="time-at-risk" class="section level3">
<h3><span class="header-section-number">9.6.4</span> Time-At-Risk</h3>
<p>We will compute the incidence rate in the first week following treatment initiation, irrespective of whether patients were exposed for the full week.</p>
</div>
</div>
<div id="implementing-the-study-using-sql-and-r" class="section level2">
<h2><span class="header-section-number">9.7</span> Implementing the Study Using SQL and R</h2>
<p>Although we are not bound to any of the OHDSI tool conventions, it is helpful to follow the same principles. In this case, we will use SQL to populate a cohort table, similarly to how the OHDSI tools work. The COHORT table is defined in the CDM, and has a predefined set of fields that we will also use. We first must create the COHORT table in a database schema where we have write access, which likely is not the same as the database schema that holds the data in CDM format.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="SqlAndR.html#cb64-1"></a><span class="kw">library</span>(DatabaseConnector)</span>
<span id="cb64-2"><a href="SqlAndR.html#cb64-2"></a>conn &lt;-<span class="st"> </span><span class="kw">connect</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb64-3"><a href="SqlAndR.html#cb64-3"></a>                <span class="dt">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,</span>
<span id="cb64-4"><a href="SqlAndR.html#cb64-4"></a>                <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb64-5"><a href="SqlAndR.html#cb64-5"></a>                <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>)</span>
<span id="cb64-6"><a href="SqlAndR.html#cb64-6"></a>cdmDbSchema &lt;-<span class="st"> &quot;cdm&quot;</span></span>
<span id="cb64-7"><a href="SqlAndR.html#cb64-7"></a>cohortDbSchema &lt;-<span class="st"> &quot;scratch&quot;</span></span>
<span id="cb64-8"><a href="SqlAndR.html#cb64-8"></a>cohortTable &lt;-<span class="st"> &quot;my_cohorts&quot;</span></span>
<span id="cb64-9"><a href="SqlAndR.html#cb64-9"></a></span>
<span id="cb64-10"><a href="SqlAndR.html#cb64-10"></a>sql &lt;-<span class="st"> &quot;</span></span>
<span id="cb64-11"><a href="SqlAndR.html#cb64-11"></a><span class="st">CREATE TABLE @cohort_db_schema.@cohort_table (</span></span>
<span id="cb64-12"><a href="SqlAndR.html#cb64-12"></a><span class="st">  cohort_definition_id INT,</span></span>
<span id="cb64-13"><a href="SqlAndR.html#cb64-13"></a><span class="st">  cohort_start_date DATE,</span></span>
<span id="cb64-14"><a href="SqlAndR.html#cb64-14"></a><span class="st">  cohort_end_date DATE,</span></span>
<span id="cb64-15"><a href="SqlAndR.html#cb64-15"></a><span class="st">  subject_id BIGINT</span></span>
<span id="cb64-16"><a href="SqlAndR.html#cb64-16"></a><span class="st">);</span></span>
<span id="cb64-17"><a href="SqlAndR.html#cb64-17"></a><span class="st">&quot;</span></span>
<span id="cb64-18"><a href="SqlAndR.html#cb64-18"></a><span class="kw">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb64-19"><a href="SqlAndR.html#cb64-19"></a>                          <span class="dt">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb64-20"><a href="SqlAndR.html#cb64-20"></a>                          <span class="dt">cohort_table =</span> cohortTable)</span></code></pre></div>
<p>Here we have parameterized the database schema and table names, so we can easily adapt them to different environments. The result is an empty table on the database server.</p>
<div id="exposure-cohort" class="section level3">
<h3><span class="header-section-number">9.7.1</span> Exposure Cohort</h3>
<p>Next we create our exposure cohort, and insert it into our COHORT table:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="SqlAndR.html#cb65-1"></a>sql &lt;-<span class="st"> &quot;</span></span>
<span id="cb65-2"><a href="SqlAndR.html#cb65-2"></a><span class="st">INSERT INTO @cohort_db_schema.@cohort_table (</span></span>
<span id="cb65-3"><a href="SqlAndR.html#cb65-3"></a><span class="st">  cohort_definition_id,</span></span>
<span id="cb65-4"><a href="SqlAndR.html#cb65-4"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb65-5"><a href="SqlAndR.html#cb65-5"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb65-6"><a href="SqlAndR.html#cb65-6"></a><span class="st">  subject_id</span></span>
<span id="cb65-7"><a href="SqlAndR.html#cb65-7"></a><span class="st">)</span></span>
<span id="cb65-8"><a href="SqlAndR.html#cb65-8"></a><span class="st">SELECT 1 AS cohort_definition_id,</span></span>
<span id="cb65-9"><a href="SqlAndR.html#cb65-9"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb65-10"><a href="SqlAndR.html#cb65-10"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb65-11"><a href="SqlAndR.html#cb65-11"></a><span class="st">  subject_id</span></span>
<span id="cb65-12"><a href="SqlAndR.html#cb65-12"></a><span class="st">FROM (</span></span>
<span id="cb65-13"><a href="SqlAndR.html#cb65-13"></a><span class="st">  SELECT drug_era_start_date AS cohort_start_date,</span></span>
<span id="cb65-14"><a href="SqlAndR.html#cb65-14"></a><span class="st">    drug_era_end_date AS cohort_end_date,</span></span>
<span id="cb65-15"><a href="SqlAndR.html#cb65-15"></a><span class="st">    person_id AS subject_id</span></span>
<span id="cb65-16"><a href="SqlAndR.html#cb65-16"></a><span class="st">  FROM (</span></span>
<span id="cb65-17"><a href="SqlAndR.html#cb65-17"></a><span class="st">    SELECT drug_era_start_date,</span></span>
<span id="cb65-18"><a href="SqlAndR.html#cb65-18"></a><span class="st">      drug_era_end_date,</span></span>
<span id="cb65-19"><a href="SqlAndR.html#cb65-19"></a><span class="st">      person_id,</span></span>
<span id="cb65-20"><a href="SqlAndR.html#cb65-20"></a><span class="st">      ROW_NUMBER() OVER (</span></span>
<span id="cb65-21"><a href="SqlAndR.html#cb65-21"></a><span class="st">        PARTITION BY person_id</span></span>
<span id="cb65-22"><a href="SqlAndR.html#cb65-22"></a><span class="st">            ORDER BY drug_era_start_date</span></span>
<span id="cb65-23"><a href="SqlAndR.html#cb65-23"></a><span class="st">      ) order_nr</span></span>
<span id="cb65-24"><a href="SqlAndR.html#cb65-24"></a><span class="st">    FROM @cdm_db_schema.drug_era</span></span>
<span id="cb65-25"><a href="SqlAndR.html#cb65-25"></a><span class="st">    WHERE drug_concept_id = 1308216 -- Lisinopril</span></span>
<span id="cb65-26"><a href="SqlAndR.html#cb65-26"></a><span class="st">  ) ordered_exposures</span></span>
<span id="cb65-27"><a href="SqlAndR.html#cb65-27"></a><span class="st">  WHERE order_nr = 1</span></span>
<span id="cb65-28"><a href="SqlAndR.html#cb65-28"></a><span class="st">) first_era</span></span>
<span id="cb65-29"><a href="SqlAndR.html#cb65-29"></a><span class="st">INNER JOIN @cdm_db_schema.observation_period</span></span>
<span id="cb65-30"><a href="SqlAndR.html#cb65-30"></a><span class="st">  ON subject_id = person_id</span></span>
<span id="cb65-31"><a href="SqlAndR.html#cb65-31"></a><span class="st">    AND observation_period_start_date &lt; cohort_start_date</span></span>
<span id="cb65-32"><a href="SqlAndR.html#cb65-32"></a><span class="st">    AND observation_period_end_date &gt; cohort_start_date</span></span>
<span id="cb65-33"><a href="SqlAndR.html#cb65-33"></a><span class="st">WHERE DATEDIFF(DAY,</span></span>
<span id="cb65-34"><a href="SqlAndR.html#cb65-34"></a><span class="st">               observation_period_start_date,</span></span>
<span id="cb65-35"><a href="SqlAndR.html#cb65-35"></a><span class="st">               cohort_start_date) &gt;= 365;</span></span>
<span id="cb65-36"><a href="SqlAndR.html#cb65-36"></a><span class="st">&quot;</span></span>
<span id="cb65-37"><a href="SqlAndR.html#cb65-37"></a></span>
<span id="cb65-38"><a href="SqlAndR.html#cb65-38"></a><span class="kw">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb65-39"><a href="SqlAndR.html#cb65-39"></a>                          <span class="dt">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb65-40"><a href="SqlAndR.html#cb65-40"></a>                          <span class="dt">cohort_table =</span> cohortTable,</span>
<span id="cb65-41"><a href="SqlAndR.html#cb65-41"></a>                          <span class="dt">cdm_db_schema =</span> cdmDbSchema)</span></code></pre></div>
<p>Here we use the DRUG_ERA table, a standard table in the CDM that is automatically derived from the DRUG_EXPOSURE table. The DRUG_ERA table contains eras of continuous exposure at the ingredient level. We can thus search for lisinopril, and this will automatically identify all exposures to drugs containing lisinopril. We take the first drug exposure per person, and then join to the OBSERVATION_PERIOD table, and because a person can have several observation periods we must make sure we only join to the period containing the drug exposure. We then require at least 365 days between the OBSERVATION_PERIOD_START_DATE and the COHORT_START_DATE.</p>
</div>
<div id="outcome-cohort" class="section level3">
<h3><span class="header-section-number">9.7.2</span> Outcome Cohort</h3>
<p>Finally, we must create our outcome cohort:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="SqlAndR.html#cb66-1"></a>sql &lt;-<span class="st"> &quot;</span></span>
<span id="cb66-2"><a href="SqlAndR.html#cb66-2"></a><span class="st">INSERT INTO @cohort_db_schema.@cohort_table (</span></span>
<span id="cb66-3"><a href="SqlAndR.html#cb66-3"></a><span class="st"> cohort_definition_id,</span></span>
<span id="cb66-4"><a href="SqlAndR.html#cb66-4"></a><span class="st"> cohort_start_date,</span></span>
<span id="cb66-5"><a href="SqlAndR.html#cb66-5"></a><span class="st"> cohort_end_date,</span></span>
<span id="cb66-6"><a href="SqlAndR.html#cb66-6"></a><span class="st">subject_id</span></span>
<span id="cb66-7"><a href="SqlAndR.html#cb66-7"></a><span class="st">)</span></span>
<span id="cb66-8"><a href="SqlAndR.html#cb66-8"></a><span class="st">SELECT 2 AS cohort_definition_id,</span></span>
<span id="cb66-9"><a href="SqlAndR.html#cb66-9"></a><span class="st">  cohort_start_date,</span></span>
<span id="cb66-10"><a href="SqlAndR.html#cb66-10"></a><span class="st">  cohort_end_date,</span></span>
<span id="cb66-11"><a href="SqlAndR.html#cb66-11"></a><span class="st">  subject_id</span></span>
<span id="cb66-12"><a href="SqlAndR.html#cb66-12"></a><span class="st">FROM (</span></span>
<span id="cb66-13"><a href="SqlAndR.html#cb66-13"></a><span class="st">  SELECT DISTINCT person_id AS subject_id,</span></span>
<span id="cb66-14"><a href="SqlAndR.html#cb66-14"></a><span class="st">    condition_start_date AS cohort_start_date,</span></span>
<span id="cb66-15"><a href="SqlAndR.html#cb66-15"></a><span class="st">    condition_end_date AS cohort_end_date</span></span>
<span id="cb66-16"><a href="SqlAndR.html#cb66-16"></a><span class="st">  FROM @cdm_db_schema.condition_occurrence</span></span>
<span id="cb66-17"><a href="SqlAndR.html#cb66-17"></a><span class="st">  INNER JOIN @cdm_db_schema.concept_ancestor</span></span>
<span id="cb66-18"><a href="SqlAndR.html#cb66-18"></a><span class="st">    ON condition_concept_id = descendant_concept_id</span></span>
<span id="cb66-19"><a href="SqlAndR.html#cb66-19"></a><span class="st">  WHERE ancestor_concept_id = 432791 -- Angioedema</span></span>
<span id="cb66-20"><a href="SqlAndR.html#cb66-20"></a><span class="st">) distinct_occurrence</span></span>
<span id="cb66-21"><a href="SqlAndR.html#cb66-21"></a><span class="st">INNER JOIN @cdm_db_schema.visit_occurrence</span></span>
<span id="cb66-22"><a href="SqlAndR.html#cb66-22"></a><span class="st">  ON subject_id = person_id</span></span>
<span id="cb66-23"><a href="SqlAndR.html#cb66-23"></a><span class="st">  AND visit_start_date &lt;= cohort_start_date</span></span>
<span id="cb66-24"><a href="SqlAndR.html#cb66-24"></a><span class="st">  AND visit_end_date &gt;= cohort_start_date</span></span>
<span id="cb66-25"><a href="SqlAndR.html#cb66-25"></a><span class="st">WHERE visit_concept_id IN (262, 9203,</span></span>
<span id="cb66-26"><a href="SqlAndR.html#cb66-26"></a><span class="st">    9201) -- Inpatient or ER;</span></span>
<span id="cb66-27"><a href="SqlAndR.html#cb66-27"></a><span class="st">&quot;</span></span>
<span id="cb66-28"><a href="SqlAndR.html#cb66-28"></a></span>
<span id="cb66-29"><a href="SqlAndR.html#cb66-29"></a><span class="kw">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb66-30"><a href="SqlAndR.html#cb66-30"></a>                          <span class="dt">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb66-31"><a href="SqlAndR.html#cb66-31"></a>                          <span class="dt">cohort_table =</span> cohortTable,</span>
<span id="cb66-32"><a href="SqlAndR.html#cb66-32"></a>                          <span class="dt">cdm_db_schema =</span> cdmDbSchema)</span></code></pre></div>
<p>Here we join the CONDITION_OCCURRENCE table to the CONCEPT_ANCESTOR table to find all occurrences of angioedema or any of its descendants. We use DISTINCT to make sure we only select one record per day, as we believe multiple angioedema diagnoses on the same day are more likely to be the same occurrence rather than multiple angioedema events. We join these occurrences to the VISIT_OCCURRENCE table to ensure the diagnosis was made in and inpatient or ER setting.</p>
</div>
<div id="incidence-rate-calculation" class="section level3">
<h3><span class="header-section-number">9.7.3</span> Incidence Rate Calculation</h3>
<p>Now that our cohorts are in place, we can compute the incidence rate, stratified by age and gender:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="SqlAndR.html#cb67-1"></a>sql &lt;-<span class="st"> &quot;</span></span>
<span id="cb67-2"><a href="SqlAndR.html#cb67-2"></a><span class="st">WITH tar AS (</span></span>
<span id="cb67-3"><a href="SqlAndR.html#cb67-3"></a><span class="st">  SELECT concept_name AS gender,</span></span>
<span id="cb67-4"><a href="SqlAndR.html#cb67-4"></a><span class="st">    FLOOR((YEAR(cohort_start_date) -</span></span>
<span id="cb67-5"><a href="SqlAndR.html#cb67-5"></a><span class="st">          year_of_birth) / 10) AS age,</span></span>
<span id="cb67-6"><a href="SqlAndR.html#cb67-6"></a><span class="st">    subject_id,</span></span>
<span id="cb67-7"><a href="SqlAndR.html#cb67-7"></a><span class="st">    cohort_start_date,</span></span>
<span id="cb67-8"><a href="SqlAndR.html#cb67-8"></a><span class="st">    CASE WHEN DATEADD(DAY, 7, cohort_start_date) &gt;</span></span>
<span id="cb67-9"><a href="SqlAndR.html#cb67-9"></a><span class="st">      observation_period_end_date</span></span>
<span id="cb67-10"><a href="SqlAndR.html#cb67-10"></a><span class="st">    THEN observation_period_end_date</span></span>
<span id="cb67-11"><a href="SqlAndR.html#cb67-11"></a><span class="st">    ELSE DATEADD(DAY, 7, cohort_start_date)</span></span>
<span id="cb67-12"><a href="SqlAndR.html#cb67-12"></a><span class="st">    END AS cohort_end_date</span></span>
<span id="cb67-13"><a href="SqlAndR.html#cb67-13"></a><span class="st">  FROM @cohort_db_schema.@cohort_table</span></span>
<span id="cb67-14"><a href="SqlAndR.html#cb67-14"></a><span class="st">  INNER JOIN @cdm_db_schema.observation_period</span></span>
<span id="cb67-15"><a href="SqlAndR.html#cb67-15"></a><span class="st">    ON subject_id = observation_period.person_id</span></span>
<span id="cb67-16"><a href="SqlAndR.html#cb67-16"></a><span class="st">      AND observation_period_start_date &lt; cohort_start_date</span></span>
<span id="cb67-17"><a href="SqlAndR.html#cb67-17"></a><span class="st">      AND observation_period_end_date &gt; cohort_start_date</span></span>
<span id="cb67-18"><a href="SqlAndR.html#cb67-18"></a><span class="st">  INNER JOIN @cdm_db_schema.person</span></span>
<span id="cb67-19"><a href="SqlAndR.html#cb67-19"></a><span class="st">    ON subject_id = person.person_id</span></span>
<span id="cb67-20"><a href="SqlAndR.html#cb67-20"></a><span class="st">  INNER JOIN @cdm_db_schema.concept</span></span>
<span id="cb67-21"><a href="SqlAndR.html#cb67-21"></a><span class="st">    ON gender_concept_id = concept_id</span></span>
<span id="cb67-22"><a href="SqlAndR.html#cb67-22"></a><span class="st">  WHERE cohort_definition_id = 1 -- Exposure</span></span>
<span id="cb67-23"><a href="SqlAndR.html#cb67-23"></a><span class="st">)</span></span>
<span id="cb67-24"><a href="SqlAndR.html#cb67-24"></a><span class="st">SELECT days.gender,</span></span>
<span id="cb67-25"><a href="SqlAndR.html#cb67-25"></a><span class="st">    days.age,</span></span>
<span id="cb67-26"><a href="SqlAndR.html#cb67-26"></a><span class="st">    days,</span></span>
<span id="cb67-27"><a href="SqlAndR.html#cb67-27"></a><span class="st">    CASE WHEN events IS NULL THEN 0 ELSE events END AS events</span></span>
<span id="cb67-28"><a href="SqlAndR.html#cb67-28"></a><span class="st">FROM (</span></span>
<span id="cb67-29"><a href="SqlAndR.html#cb67-29"></a><span class="st">  SELECT gender,</span></span>
<span id="cb67-30"><a href="SqlAndR.html#cb67-30"></a><span class="st">    age,</span></span>
<span id="cb67-31"><a href="SqlAndR.html#cb67-31"></a><span class="st">    SUM(DATEDIFF(DAY, cohort_start_date,</span></span>
<span id="cb67-32"><a href="SqlAndR.html#cb67-32"></a><span class="st">      cohort_end_date)) AS days</span></span>
<span id="cb67-33"><a href="SqlAndR.html#cb67-33"></a><span class="st">  FROM tar</span></span>
<span id="cb67-34"><a href="SqlAndR.html#cb67-34"></a><span class="st">  GROUP BY gender,</span></span>
<span id="cb67-35"><a href="SqlAndR.html#cb67-35"></a><span class="st">    age</span></span>
<span id="cb67-36"><a href="SqlAndR.html#cb67-36"></a><span class="st">) days</span></span>
<span id="cb67-37"><a href="SqlAndR.html#cb67-37"></a><span class="st">LEFT JOIN (</span></span>
<span id="cb67-38"><a href="SqlAndR.html#cb67-38"></a><span class="st">  SELECT gender,</span></span>
<span id="cb67-39"><a href="SqlAndR.html#cb67-39"></a><span class="st">      age,</span></span>
<span id="cb67-40"><a href="SqlAndR.html#cb67-40"></a><span class="st">      COUNT(*) AS events</span></span>
<span id="cb67-41"><a href="SqlAndR.html#cb67-41"></a><span class="st">  FROM tar</span></span>
<span id="cb67-42"><a href="SqlAndR.html#cb67-42"></a><span class="st">  INNER JOIN @cohort_db_schema.@cohort_table angioedema</span></span>
<span id="cb67-43"><a href="SqlAndR.html#cb67-43"></a><span class="st">    ON tar.subject_id = angioedema.subject_id</span></span>
<span id="cb67-44"><a href="SqlAndR.html#cb67-44"></a><span class="st">      AND tar.cohort_start_date &lt;= angioedema.cohort_start_date</span></span>
<span id="cb67-45"><a href="SqlAndR.html#cb67-45"></a><span class="st">      AND tar.cohort_end_date &gt;= angioedema.cohort_start_date</span></span>
<span id="cb67-46"><a href="SqlAndR.html#cb67-46"></a><span class="st">  WHERE cohort_definition_id = 2 -- Outcome</span></span>
<span id="cb67-47"><a href="SqlAndR.html#cb67-47"></a><span class="st">  GROUP BY gender,</span></span>
<span id="cb67-48"><a href="SqlAndR.html#cb67-48"></a><span class="st">    age</span></span>
<span id="cb67-49"><a href="SqlAndR.html#cb67-49"></a><span class="st">) events</span></span>
<span id="cb67-50"><a href="SqlAndR.html#cb67-50"></a><span class="st">ON days.gender = events.gender</span></span>
<span id="cb67-51"><a href="SqlAndR.html#cb67-51"></a><span class="st">  AND days.age = events.age;</span></span>
<span id="cb67-52"><a href="SqlAndR.html#cb67-52"></a><span class="st">&quot;</span></span>
<span id="cb67-53"><a href="SqlAndR.html#cb67-53"></a></span>
<span id="cb67-54"><a href="SqlAndR.html#cb67-54"></a>results &lt;-<span class="st"> </span><span class="kw">renderTranslateQuerySql</span>(conn, sql,</span>
<span id="cb67-55"><a href="SqlAndR.html#cb67-55"></a>                                   <span class="dt">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb67-56"><a href="SqlAndR.html#cb67-56"></a>                                   <span class="dt">cohort_table =</span> cohortTable,</span>
<span id="cb67-57"><a href="SqlAndR.html#cb67-57"></a>                                   <span class="dt">cdm_db_schema =</span> cdmDbSchema,</span>
<span id="cb67-58"><a href="SqlAndR.html#cb67-58"></a>                                   <span class="dt">snakeCaseToCamelCase =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>We first create “tar,” a CTE that contains all exposures with the appropriate time-at-risk. Note that we truncate the time-at-risk at the OBSERVATION_PERIOD_END_DATE. We also compute the age in 10-year bins, and identify the gender. The advantage of using a CTE is that we can use the same set of intermediate results several times in a query. In this case we use it to count the total amount of time-at-risk, as well as the number of angioedema events that occur during the time-at-risk.</p>
<p>We use <code>snakeCaseToCamelCase = TRUE</code> because in SQL we tend to use snake_case for field names (because SQL in case-insensitive), whereas in R we tend to use camelCase (because R is case-sensitive). The <code>results</code> data frame column names will now be in camelCase.</p>
<p>With the help of the ggplot2 package we can easily plot our results:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="SqlAndR.html#cb68-1"></a><span class="co"># Compute incidence rate (IR) :</span></span>
<span id="cb68-2"><a href="SqlAndR.html#cb68-2"></a>results<span class="op">$</span>ir &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="op">*</span><span class="st"> </span>results<span class="op">$</span>events <span class="op">/</span><span class="st"> </span>results<span class="op">$</span>days <span class="op">/</span><span class="st"> </span><span class="dv">7</span></span>
<span id="cb68-3"><a href="SqlAndR.html#cb68-3"></a></span>
<span id="cb68-4"><a href="SqlAndR.html#cb68-4"></a><span class="co"># Fix age scale:</span></span>
<span id="cb68-5"><a href="SqlAndR.html#cb68-5"></a>results<span class="op">$</span>age &lt;-<span class="st"> </span>results<span class="op">$</span>age <span class="op">*</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb68-6"><a href="SqlAndR.html#cb68-6"></a></span>
<span id="cb68-7"><a href="SqlAndR.html#cb68-7"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb68-8"><a href="SqlAndR.html#cb68-8"></a><span class="kw">ggplot</span>(results, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> ir, <span class="dt">group =</span> gender, <span class="dt">color =</span> gender)) <span class="op">+</span></span>
<span id="cb68-9"><a href="SqlAndR.html#cb68-9"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb68-10"><a href="SqlAndR.html#cb68-10"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age&quot;</span>) <span class="op">+</span></span>
<span id="cb68-11"><a href="SqlAndR.html#cb68-11"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Incidence (per 1,000 patient weeks)&quot;</span>)</span></code></pre></div>
<p><img src="images/SqlAndR/ir.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="clean-up" class="section level3">
<h3><span class="header-section-number">9.7.4</span> Clean Up</h3>
<p>Don’t forget to clean up the table we created, and to close the connection:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="SqlAndR.html#cb69-1"></a>sql &lt;-<span class="st"> &quot;</span></span>
<span id="cb69-2"><a href="SqlAndR.html#cb69-2"></a><span class="st">TRUNCATE TABLE @cohort_db_schema.@cohort_table;</span></span>
<span id="cb69-3"><a href="SqlAndR.html#cb69-3"></a><span class="st">DROP TABLE @cohort_db_schema.@cohort_table;</span></span>
<span id="cb69-4"><a href="SqlAndR.html#cb69-4"></a><span class="st">&quot;</span></span>
<span id="cb69-5"><a href="SqlAndR.html#cb69-5"></a><span class="kw">renderTranslateExecuteSql</span>(conn, sql,</span>
<span id="cb69-6"><a href="SqlAndR.html#cb69-6"></a>                          <span class="dt">cohort_db_schema =</span> cohortDbSchema,</span>
<span id="cb69-7"><a href="SqlAndR.html#cb69-7"></a>                          <span class="dt">cohort_table =</span> cohortTable)</span>
<span id="cb69-8"><a href="SqlAndR.html#cb69-8"></a></span>
<span id="cb69-9"><a href="SqlAndR.html#cb69-9"></a><span class="kw">disconnect</span>(conn)</span></code></pre></div>
</div>
<div id="compatibility" class="section level3">
<h3><span class="header-section-number">9.7.5</span> Compatibility</h3>
<p>Because we use OHDSI SQL together with DatabaseConnector and SqlRender throughout, the code we reviewed here will run on any database platform supported by OHDSI.</p>
<p>Note that for demonstration purposes we chose to create our cohorts using hand-crafted SQL. It would probably have been more convenient to construct cohort definition in ATLAS, and use the SQL generated by ATLAS to instantiate the cohorts. ATLAS also produced OHDSI SQL, and can therefore easily be used together with SqlRender and DatabaseConnector.</p>
</div>
</div>
<div id="summary-7" class="section level2">
<h2><span class="header-section-number">9.8</span> Summary</h2>

<div class="rmdsummary">
<ul>
<li><p><strong>SQL</strong> (Structured Query Language) is a standard language for querying databases, including those that conform to the Common Data Model (CDM).</p></li>
<li><p>Different database platforms have different SQL dialects, and require different tools to query them.</p></li>
<li><p>The <strong>SqlRender</strong> and <strong>DatabaseConnector</strong> R packages provide a unified way to query data in the CDM, allowing the same analysis code to be run in different environments without modification.</p></li>
<li><p>By using R and SQL together we can implement custom analyses that are not supported by the OHDSI tools.</p></li>
<li><p>The <strong>QueryLibrary</strong> provides a collection of re-usable SQL queries for the CDM.</p></li>
</ul>
</div>

</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">9.9</span> Exercises</h2>
<div id="prerequisites-3" class="section level4 unnumbered">
<h4>Prerequisites</h4>
<p>For these exercises we assume R, R-Studio and Java have been installed as described in Section <a href="OhdsiAnalyticsTools.html#installR">8.4.5</a>. Also required are the <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a>, <a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a>, and <a href="https://ohdsi.github.io/Eunomia/">Eunomia</a> packages, which can be installed using:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="SqlAndR.html#cb70-1"></a><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;SqlRender&quot;</span>, <span class="st">&quot;DatabaseConnector&quot;</span>, <span class="st">&quot;remotes&quot;</span>))</span>
<span id="cb70-2"><a href="SqlAndR.html#cb70-2"></a>remotes<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ohdsi/Eunomia&quot;</span>, <span class="dt">ref =</span> <span class="st">&quot;v1.0.0&quot;</span>)</span></code></pre></div>
<p>The Eunomia package provides a simulated dataset in the CDM that will run inside your local R session. The connection details can be obtained using:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="SqlAndR.html#cb71-1"></a>connectionDetails &lt;-<span class="st"> </span>Eunomia<span class="op">::</span><span class="kw">getEunomiaConnectionDetails</span>()</span></code></pre></div>
<p>The CDM database schema is “main”.</p>

<div class="exercise">
<p><span id="exr:exercisePeopleCount" class="exercise"><strong>Exercise 9.1  </strong></span>Using SQL and R, compute how many people are in the database.</p>
</div>


<div class="exercise">
<p><span id="exr:exerciseCelecoxibUsers" class="exercise"><strong>Exercise 9.2  </strong></span>Using SQL and R, compute how many people have at least one prescription of celecoxib.</p>
</div>


<div class="exercise">
<p><span id="exr:exerciseGiBleedsDuringCelecoxib" class="exercise"><strong>Exercise 9.3  </strong></span>Using SQL and R, compute how many diagnoses of gastrointestinal hemorrhage occur during exposure to celecoxib. (Hint: the concept ID for gastrointestinal hemorrhage is <a href="http://athena.ohdsi.org/search-terms/terms/192671">192671</a>.)</p>
</div>

<p>Suggested answers can be found in Appendix <a href="SuggestedAnswers.html#SqlAndRanswers">E.5</a>.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-slater_1988">
<p>Slater, Eve E., Debora D. Merrill, Harry A. Guess, Peter J. Roylance, Warren D. Cooper, William H. W. Inman, and Pamela W. Ewan. 1988. “Clinical Profile of Angioedema Associated With Angiotensin Converting-Enzyme Inhibition.” <em>JAMA</em> 260 (7): 967–70. <a href="https://doi.org/10.1001/jama.1988.03410070095035">https://doi.org/10.1001/jama.1988.03410070095035</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="51">
<li id="fn51"><p><a href="http://data.ohdsi.org/SqlDeveloper/" class="uri">http://data.ohdsi.org/SqlDeveloper/</a><a href="SqlAndR.html#fnref51" class="footnote-back">↩︎</a></p></li>
<li id="fn52"><p><a href="http://data.ohdsi.org/QueryLibrary" class="uri">http://data.ohdsi.org/QueryLibrary</a><a href="SqlAndR.html#fnref52" class="footnote-back">↩︎</a></p></li>
<li id="fn53"><p><a href="https://github.com/OHDSI/QueryLibrary" class="uri">https://github.com/OHDSI/QueryLibrary</a><a href="SqlAndR.html#fnref53" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="OhdsiAnalyticsTools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Cohorts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHDSI/TheBookOfOhdsi/edit/master/SqlAndR.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TheBookOfOhdsi.pdf", "TheBookOfOhdsi.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
